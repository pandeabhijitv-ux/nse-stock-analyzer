<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSE Stock Analyzer - Indian Market</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        #root {
            max-width: 400px;
            margin: 0 auto;
            background: #f5f5f5;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .sectors {
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 100%;
            box-sizing: border-box;
        }
        .sector-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid;
            box-sizing: border-box;
            min-width: 0;
            overflow: hidden;
        }
        .sector-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .sector-card h3 {
            font-size: 18px;
            margin-bottom: 5px;
            color: #333;
        }
        .sector-card p {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        .stock-count {
            display: inline-block;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: #666;
        }
        .stock-list {
            padding: 15px;
        }
        .stock-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .stock-item:hover {
            transform: translateX(5px);
        }
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .stock-symbol {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        .stock-score {
            font-size: 18px;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 8px;
            color: white;
        }
        .score-high { background: #22c55e; }
        .score-medium { background: #f59e0b; }
        .score-low { background: #ef4444; }
        .stock-name {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        .stock-price {
            font-size: 14px;
            color: #333;
        }
        .back-button {
            background: white;
            border: none;
            padding: 10px 15px;
            margin: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .back-button:hover {
            background: #f0f0f0;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }
        .stock-detail {
            padding: 15px;
        }
        .detail-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .recommendation {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        .recommendation.buy { background: #22c55e; }
        .recommendation.hold { background: #f59e0b; }
        .recommendation.sell { background: #ef4444; }
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .metric-row:last-child {
            border-bottom: none;
        }
        .metric-label {
            color: #666;
            font-size: 14px;
        }
        .metric-value {
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        .tabs {
            display: flex;
            background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f5 100%);
            border-radius: 10px;
            padding: 6px;
            margin: 15px;
            overflow-x: auto;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
            border: 2px solid #ddd;
            /* Show scrollbar */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #667eea #e0e0e0; /* Firefox */
        }
        /* Chrome/Safari scrollbar */
        .tabs::-webkit-scrollbar {
            height: 8px;
            display: block;
        }
        .tabs::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        .tabs::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        .tabs::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }
        .tab {
            flex: 0 0 auto;
            min-width: fit-content;
            padding: 10px 16px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s;
            white-space: nowrap;
            background: white;
            margin: 0 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .options-badge {
            display: inline-block;
            background: #22c55e;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: bold;
            margin-left: 3px;
        }
        .options-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .options-header {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            color: white;
            font-weight: bold;
        }
        .options-header.bullish {
            background: #22c55e;
        }
        .options-header.bearish {
            background: #ef4444;
        }
        .options-header.neutral {
            background: #f59e0b;
        }
        .strike-option {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .strike-option.recommended {
            border: 2px solid #22c55e;
            background: #f0fdf4;
        }
        .strike-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .strike-label {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
        .strike-price {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
        }
        .premium-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 12px;
        }
        .greek-item {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .greek-name {
            font-size: 13px;
            font-weight: 600;
            color: #666;
        }
        .greek-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin: 5px 0;
        }
        .greek-desc {
            font-size: 11px;
            color: #999;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Version: 2026-01-04-v6 - Fixed Options Trading useEffect
        const { useState, useEffect } = React;

        // Indian NSE Sectors and Stocks
        const SECTORS = {
            Technology: ['TCS', 'INFY', 'WIPRO', 'HCLTECH', 'TECHM', 'LTI', 'COFORGE', 'MINDTREE', 'MPHASIS', 'PERSISTENT'],
            Banking: ['HDFCBANK', 'ICICIBANK', 'SBIN', 'KOTAKBANK', 'AXISBANK', 'INDUSINDBK', 'BANKBARODA', 'PNB', 'FEDERALBNK', 'IDFCFIRSTB'],
            'Financial Services': ['BAJFINANCE', 'BAJAJFINSV', 'HDFCLIFE', 'SBILIFE', 'ICICIGI', 'HDFCAMC', 'MUTHOOTFIN', 'CHOLAFIN', 'M&MFIN', 'PFC'],
            FMCG: ['HINDUNILVR', 'ITC', 'NESTLEIND', 'BRITANNIA', 'DABUR', 'MARICO', 'GODREJCP', 'COLPAL', 'TATACONSUM', 'EMAMILTD'],
            Automobile: ['MARUTI', 'TATAMOTORS', 'M&M', 'BAJAJ-AUTO', 'EICHERMOT', 'HEROMOTOCO', 'ASHOKLEY', 'TVSMOTOR', 'MOTHERSUMI', 'MRF'],
            Pharma: ['SUNPHARMA', 'DRREDDY', 'CIPLA', 'DIVISLAB', 'AUROPHARMA', 'LUPIN', 'BIOCON', 'TORNTPHARM', 'ALKEM', 'CADILAHC'],
            Energy: ['RELIANCE', 'ONGC', 'IOC', 'BPCL', 'HINDPETRO', 'GAIL', 'COALINDIA', 'ADANIGREEN', 'ADANIPOWER', 'TATAPOWER'],
            'Metals & Mining': ['TATASTEEL', 'HINDALCO', 'JSWSTEEL', 'VEDL', 'SAIL', 'JINDALSTEL', 'NMDC', 'HINDZINC', 'NATIONALUM', 'APLAPOLLO'],
            Infrastructure: ['LT', 'ULTRACEMCO', 'GRASIM', 'ADANIPORTS', 'HINDCOPPER', 'RAMCOCEM', 'SHREECEM', 'AMBUJACEM', 'ACC', 'CONCOR'],
            'Consumer Durables': ['TITAN', 'HAVELLS', 'VOLTAS', 'WHIRLPOOL', 'CROMPTON', 'BATAINDIA', 'SYMPHONY', 'BLUESTARCO', 'RAJESHEXPO', 'KAJARIACER'],
            Telecom: ['BHARTIARTL', 'IDEA', 'RCOM', 'TTML', 'GTPL', 'HFCL', 'STERLITE', 'INDIACOM', 'ONMOBILE', 'RTNPOWER'],
            'Real Estate': ['DLF', 'GODREJPROP', 'OBEROIRLTY', 'PRESTIGE', 'PHOENIXLTD', 'SOBHA', 'BRIGADE', 'MAHLIFE', 'SUNTECK', 'IBREALEST'],
            Chemicals: ['UPL', 'PIDILITIND', 'AARTI', 'DEEPAKNI', 'SRF', 'NAVINFLUOR', 'ATUL', 'BALRAMCHIN', 'TATACHEMICAL', 'GHCL'],
            Media: ['ZEEL', 'SUNTV', 'TVTODAY', 'TIPS', 'PVR', 'SAREGAMA', 'BALAJITELE', 'NAZARA', 'UTVME', 'EROS'],
            Hotels: ['INDHOTEL', 'LEMONTREE', 'EIH', 'TAJGVK', 'CHALET', 'ORIENTHOT', 'MAHINDCIE', 'ROYALORCH', 'TRENT', 'WESTLIFE'],
            Textiles: ['ARVIND', 'TRIDENT', 'WELSPUNIND', 'KPR', 'VARDHMAN', 'ALOKTEXT', 'RAYMOND', 'SPICEJET', 'AHLEAST', 'GOKEX'],
            Power: ['NTPC', 'POWERGRID', 'REC', 'NHPC', 'SJVN', 'JSPL', 'JSW ENERGY', 'TORNTPOWER', 'CESC', 'ADITYA'],
            Retail: ['DMART', 'TRENT', 'SHOPERSTOP', 'VEDANT', 'ADITYA BIRLA FASHION', 'VBLSTORE', 'TITAN', 'RELAXO', 'BATA', 'WESTLIFE']
        };

        const SECTOR_COLORS = {
            Technology: '#3b82f6',
            Banking: '#10b981',
            'Financial Services': '#8b5cf6',
            FMCG: '#f59e0b',
            Automobile: '#ef4444',
            Pharma: '#06b6d4',
            Energy: '#ec4899',
            'Metals & Mining': '#14b8a6',
            Infrastructure: '#f97316',
            'Consumer Durables': '#6366f1',
            Telecom: '#8b5cf6',
            'Real Estate': '#fb923c',
            Chemicals: '#22c55e',
            Media: '#f43f5e',
            Hotels: '#06b6d4',
            Textiles: '#a855f7',
            Power: '#eab308',
            Retail: '#ec4899'
        };

        // Stock name mapping for better display
        const STOCK_NAMES = {
            TCS: 'Tata Consultancy Services',
            INFY: 'Infosys Ltd',
            WIPRO: 'Wipro Ltd',
            HCLTECH: 'HCL Technologies',
            TECHM: 'Tech Mahindra',
            HDFCBANK: 'HDFC Bank',
            ICICIBANK: 'ICICI Bank',
            SBIN: 'State Bank of India',
            KOTAKBANK: 'Kotak Mahindra Bank',
            AXISBANK: 'Axis Bank',
            BAJFINANCE: 'Bajaj Finance',
            BAJAJFINSV: 'Bajaj Finserv',
            RELIANCE: 'Reliance Industries',
            HINDUNILVR: 'Hindustan Unilever',
            ITC: 'ITC Ltd',
            MARUTI: 'Maruti Suzuki',
            TATAMOTORS: 'Tata Motors',
            'M&M': 'Mahindra & Mahindra',
            SUNPHARMA: 'Sun Pharma',
            ONGC: 'Oil & Natural Gas Corp',
            TATASTEEL: 'Tata Steel',
            LT: 'Larsen & Toubro',
            TITAN: 'Titan Company'
        };

        // Seeded random function for consistent data (LCG algorithm)
        function seededRandom(symbol, index = 0) {
            let seed = 0;
            const str = symbol + index;
            for (let i = 0; i < str.length; i++) {
                seed = ((seed << 5) - seed) + str.charCodeAt(i);
                seed = seed & 0x7FFFFFFF; // Keep it positive 32-bit
            }
            // Linear Congruential Generator
            seed = (seed * 1103515245 + 12345) & 0x7FFFFFFF;
            return seed / 0x7FFFFFFF; // Return 0-1
        }

        // Realistic price ranges for known NSE stocks (approximate real prices)
                                                                    const REALISTIC_PRICES = {
                TCS: 3245.7,
                INFY: 1642.1,
                WIPRO: 269,
                HCLTECH: 1640,
                TECHM: 1612.2,
                LTIM: 6085.5,
                COFORGE: 1653,
                PERSISTENT: 6295,
                MPHASIS: 2811,
                LTTS: 4414,
                HDFCBANK: 1000.25,
                ICICIBANK: 1355.1,
                KOTAKBANK: 2189.9,
                AXISBANK: 1269,
                SBIN: 1005.65,
                INDUSINDBK: 901.85,
                BANKBARODA: 305.8,
                PNB: 125.68,
                IDFCFIRSTB: 85.87,
                FEDERALBNK: 266.5,
                HINDUNILVR: 2348.5,
                ITC: 350.1,
                NESTLEIND: 1280.4,
                BRITANNIA: 5988,
                DABUR: 525.4,
                MARICO: 758,
                GODREJCP: 1236,
                COLPAL: 2094,
                TATACONSUM: 1171.8,
                EMAMILTD: 524,
                BAJFINANCE: 990.55,
                BAJAJFINSV: 2039.5,
                HDFCLIFE: 753.2,
                SBILIFE: 2062.2,
                ICICIGI: 1972,
                LTF: 319.1,
                CHOLAFIN: 1779.9,
                MUTHOOTFIN: 3827,
                MANAPPURAM: 311,
                MARUTI: 16970,
                HEROMOTOCO: 5931,
                'BAJAJ-AUTO': 9499,
                EICHERMOT: 7344,
                TVSMOTOR: 3874.5,
                ASHOKLEY: 187.9,
                MOTHERSON: 122,
                MRF: 150770,
                SUNPHARMA: 1729.9,
                DRREDDY: 1257.6,
                CIPLA: 1510,
                DIVISLAB: 6392,
                APOLLOHOSP: 7123.5,
                BIOCON: 393.45,
                TORNTPHARM: 3871.6,
                LUPIN: 2108,
                ALKEM: 5585,
                AUROPHARMA: 1215,
                RELIANCE: 1593,
                ONGC: 242,
                NTPC: 351.65,
                POWERGRID: 271.15,
                BPCL: 381.45,
                IOC: 166.68,
                GAIL: 175.47,
                COALINDIA: 429.1,
                ADANIGREEN: 1038.4,
                TATAPOWER: 392.65,
                TATASTEEL: 182.8,
                JSWSTEEL: 1178.1,
                HINDALCO: 926.5,
                VEDL: 616.55,
                NATIONALUM: 329.55,
                HINDZINC: 627.3,
                SAIL: 147.4,
                NMDC: 84.46,
                JINDALSTEL: 1080,
                MOIL: 375,
                LT: 4164.7,
                ADANIPORTS: 1490,
                ULTRACEMCO: 11920,
                GRASIM: 2865,
                DALBHARAT: 2150,
                RAMCOCEM: 1060,
                JKCEMENT: 5580,
                SHREECEM: 27095,
                ACC: 1750.5,
                AMBUJACEM: 566.05,
                TITAN: 4050.3,
                HAVELLS: 1440.9,
                VOLTAS: 1429.5,
                WHIRLPOOL: 901.1,
                CROMPTON: 252,
                BLUESTARCO: 1803.1,
                SYMPHONY: 919.95,
                DIXON: 12164,
                AMBER: 6485,
                RAJESHEXPO: 181.7,
                BHARTIARTL: 2108.5,
                TATACOMM: 1793,
                TTML: 49.91,
                GTPL: 99.1,
                HFCL: 67.74,
                ITI: 312.65,
                VINDHYATEL: 1411,
                ZENTEC: 1361.5,
                DLF: 698.3,
                GODREJPROP: 2070,
                OBEROIRLTY: 1731,
                PRESTIGE: 1620,
                BRIGADE: 890.45,
                SOBHA: 1495,
                PHOENIXLTD: 1897,
                MAHLIFE: 395.1,
                SUNTECK: 428.3,
                UPL: 804,
                PIDILITIND: 1477,
                SRF: 3052.4,
                BALRAMCHIN: 439.3,
                GNFC: 493.1,
                ALKYLAMINE: 1608.7,
                NAVINFLUOR: 5908,
                TATACHEM: 755,
                ZEEL: 91.1,
                SUNTV: 583.1,
                PVRINOX: 1028,
                NETWORK18: 43.85,
                SAREGAMA: 358,
                NAZARA: 284.75,
                BALAJITELE: 107,
                TVTODAY: 141,
                INDHOTEL: 748,
                LEMONTREE: 154,
                CHALET: 901.45,
                TAJGVK: 421.95,
                ORIENTHOT: 107.46,
                JAIHINDPRO: 0,
                ARVIND: 319,
                TRIDENT: 27.07,
                RAYMOND: 437,
                VARDHACRLC: 39,
                SWARAJENG: 3698.1,
                GOKEX: 718.5,
                GUJALKALI: 503,
                CENTEXT: 22.68,
                NHPC: 83.7,
                SJVN: 83.27,
                PFC: 375.9,
                TORNTPOWER: 1400.6,
                ADANIPOWER: 148.15,
                DMART: 3721,
                TRENT: 4400,
                SHOPERSTOP: 390.7,
                VMART: 706,
                VSTIND: 252.7,
                SPENCERS: 42.15,
                GULFPETRO: 35.7,
            };

        // Finnhub API Configuration for technical indicators
        const FINNHUB_API_KEY = 'd5c0hhpr01qsbmghorjd5c0hhpr01qsbmghorje';
        const TECHNICAL_CACHE_KEY = 'finnhub_technical_cache';
        const TECHNICAL_CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours
        
        // Fetch technical indicators from Finnhub API
        async function fetchFinnhubTechnicalData(symbol) {
            try {
                // Check cache first
                const cached = localStorage.getItem(`${TECHNICAL_CACHE_KEY}_${symbol}`);
                if (cached) {
                    const data = JSON.parse(cached);
                    if (Date.now() - data.timestamp < TECHNICAL_CACHE_DURATION) {
                        console.log(`ðŸ“Š Using cached technical data for ${symbol}`);
                        return data.technical;
                    }
                }
                
                const nsSymbol = `${symbol}.NS`;
                const toDate = Math.floor(Date.now() / 1000);
                const fromDate = toDate - (200 * 24 * 60 * 60); // 200 days of data
                
                console.log(`ðŸ“Š Fetching technical indicators for ${symbol} from Finnhub...`);
                
                // Fetch RSI
                const rsiResponse = await fetch(
                    `https://finnhub.io/api/v1/indicator?symbol=${nsSymbol}&resolution=D&from=${fromDate}&to=${toDate}&indicator=rsi&token=${FINNHUB_API_KEY}`
                );
                
                if (!rsiResponse.ok) {
                    console.error(`Finnhub RSI API error for ${symbol}: ${rsiResponse.status}`);
                    return null;
                }
                
                const rsiData = await rsiResponse.json();
                
                // Small delay to respect rate limit (60/min = 1 per second)
                await new Promise(resolve => setTimeout(resolve, 1100));
                
                // Fetch EMA
                const emaResponse = await fetch(
                    `https://finnhub.io/api/v1/indicator?symbol=${nsSymbol}&resolution=D&from=${fromDate}&to=${toDate}&indicator=ema&timeperiod=50&token=${FINNHUB_API_KEY}`
                );
                
                if (!emaResponse.ok) {
                    console.error(`Finnhub EMA API error for ${symbol}: ${emaResponse.status}`);
                    return null;
                }
                
                const emaData = await emaResponse.json();
                
                await new Promise(resolve => setTimeout(resolve, 1100));
                
                // Fetch EMA 200
                const ema200Response = await fetch(
                    `https://finnhub.io/api/v1/indicator?symbol=${nsSymbol}&resolution=D&from=${fromDate}&to=${toDate}&indicator=ema&timeperiod=200&token=${FINNHUB_API_KEY}`
                );
                
                if (!ema200Response.ok) {
                    console.error(`Finnhub EMA200 API error for ${symbol}: ${ema200Response.status}`);
                    return null;
                }
                
                const ema200Data = await ema200Response.json();
                
                await new Promise(resolve => setTimeout(resolve, 1100));
                
                // Fetch MACD
                const macdResponse = await fetch(
                    `https://finnhub.io/api/v1/indicator?symbol=${nsSymbol}&resolution=D&from=${fromDate}&to=${toDate}&indicator=macd&token=${FINNHUB_API_KEY}`
                );
                
                if (!macdResponse.ok) {
                    console.error(`Finnhub MACD API error for ${symbol}: ${macdResponse.status}`);
                    return null;
                }
                
                const macdData = await macdResponse.json();
                
                // Extract latest values
                const rsi = rsiData.rsi && rsiData.rsi.length > 0 ? rsiData.rsi[rsiData.rsi.length - 1] : null;
                const ema50 = emaData.ema && emaData.ema.length > 0 ? emaData.ema[emaData.ema.length - 1] : null;
                const ema200 = ema200Data.ema && ema200Data.ema.length > 0 ? ema200Data.ema[ema200Data.ema.length - 1] : null;
                const macd = macdData.macd && macdData.macd.length > 0 ? macdData.macd[macdData.macd.length - 1] : null;
                const macdSignal = macdData.macdSignal && macdData.macdSignal.length > 0 ? macdData.macdSignal[macdData.macdSignal.length - 1] : null;
                const macdHistogram = macdData.macdHist && macdData.macdHist.length > 0 ? macdData.macdHist[macdData.macdHist.length - 1] : null;
                
                if (!rsi || !ema50 || !ema200 || !macd || !macdSignal) {
                    console.warn(`Incomplete technical data for ${symbol}`);
                    return null;
                }
                
                const technical = {
                    rsi: parseFloat(rsi.toFixed(2)),
                    ema50: parseFloat(ema50.toFixed(2)),
                    ema200: parseFloat(ema200.toFixed(2)),
                    macd: parseFloat(macd.toFixed(2)),
                    macdSignal: parseFloat(macdSignal.toFixed(2)),
                    macdHistogram: parseFloat(macdHistogram.toFixed(2))
                };
                
                // Cache the result
                localStorage.setItem(`${TECHNICAL_CACHE_KEY}_${symbol}`, JSON.stringify({
                    technical,
                    timestamp: Date.now()
                }));
                
                console.log(`âœ… Fetched technical data for ${symbol}:`, technical);
                return technical;
                
            } catch (error) {
                console.error(`Error fetching technical data for ${symbol}:`, error);
                return null;
            }
        }

        // Generate mock stock data for Indian stocks with realistic prices
        // Now supports real technical data from Finnhub API
        async function generateMockStock(symbol, sectorName, useRealTechnicals = false) {
            const r = (idx) => seededRandom(symbol, idx);
            
            // Use realistic base price if available, otherwise generate
            const currentPrice = REALISTIC_PRICES[symbol] || (r(1) * 3000 + 100);
            
            const score = Math.floor(r(2) * 100);
            let rsi = r(3) * 100;
            const vix = r(4) * 30 + 10; // India VIX 10-40
            
            // Try to fetch real technical data if requested
            let realTechnicalData = null;
            if (useRealTechnicals) {
                realTechnicalData = await fetchFinnhubTechnicalData(symbol);
            }
            
            // Use real RSI if available, otherwise use mock
            if (realTechnicalData && realTechnicalData.rsi) {
                rsi = realTechnicalData.rsi;
            }
            
            // Determine options recommendation
            const isBullish = score >= 60 || rsi < 35;
            const isBearish = score <= 40 || rsi > 65;
            const optionType = isBullish ? 'CALL' : isBearish ? 'PUT' : 'STRADDLE';
            const optionSentiment = isBullish ? 'BULLISH' : isBearish ? 'BEARISH' : 'NEUTRAL';
            const confidence = Math.floor(r(5) * 30 + 60); // 60-90%
            
            // Calculate strike prices
            const roundToStrike = (price) => Math.round(price / 50) * 50;
            const atm = roundToStrike(currentPrice);
            const itm = optionType === 'CALL' ? roundToStrike(currentPrice * 0.97) : roundToStrike(currentPrice * 1.03);
            const otm = optionType === 'CALL' ? roundToStrike(currentPrice * 1.03) : roundToStrike(currentPrice * 0.97);
            
            // Calculate small random change for display
            const changePercent = (r(6) * 6 - 3); // -3% to +3%
            const change = (currentPrice * changePercent / 100);
            
            // Enhanced Technical Analysis - Use real data if available
            let ema50, ema200, macd, macdSignal, macdHistogram;
            
            if (realTechnicalData) {
                ema50 = realTechnicalData.ema50;
                ema200 = realTechnicalData.ema200;
                macd = realTechnicalData.macd;
                macdSignal = realTechnicalData.macdSignal;
                macdHistogram = realTechnicalData.macdHistogram;
                console.log(`âœ… Using REAL technical data for ${symbol}`);
            } else {
                // Fallback to mock calculations
                ema50 = parseFloat((currentPrice * (1 + (r(12) * 0.1 - 0.05))).toFixed(2));
                ema200 = parseFloat((currentPrice * (1 + (r(13) * 0.2 - 0.1))).toFixed(2));
                macd = parseFloat((r(11) * 10 - 5).toFixed(2));
                macdSignal = parseFloat((macd * 0.9).toFixed(2));
                macdHistogram = macd - macdSignal;
            }
            
            // Moving Average Crossover Analysis
            const maCrossover = ema50 > ema200 ? 'Golden Cross (Bullish)' : 'Death Cross (Bearish)';
            const maTrend = ema50 > ema200 ? 'BULLISH' : 'BEARISH';
            const maStrength = Math.abs((ema50 - ema200) / ema200 * 100);
            
            // MACD Analysis
            const macdSignalType = macd > macdSignal ? 'Bullish Crossover' : 'Bearish Crossover';
            const macdTrend = macdHistogram > 0 ? 'BULLISH' : 'BEARISH';
            
            // Support & Resistance Levels
            const support1 = (currentPrice * 0.95).toFixed(2);
            const support2 = (currentPrice * 0.90).toFixed(2);
            const resistance1 = (currentPrice * 1.05).toFixed(2);
            const resistance2 = (currentPrice * 1.10).toFixed(2);
            
            // Volume Analysis
            const avgVolume = (r(27) * 40 + 10).toFixed(1);
            const volumeTrend = parseFloat(avgVolume) > 25 ? 'High Volume (Strong Interest)' : 'Normal Volume';
            
            // RSI Interpretation
            let rsiSignal = '';
            if (rsi < 30) rsiSignal = 'Oversold (Bullish Signal)';
            else if (rsi > 70) rsiSignal = 'Overbought (Bearish Signal)';
            else if (rsi >= 40 && rsi <= 60) rsiSignal = 'Neutral Zone (Range Bound)';
            else rsiSignal = 'Normal Range';
            
            // Chart Pattern Detection
            const patterns = [
                { name: 'Ascending Triangle', type: 'BULLISH', target: (currentPrice * 1.15).toFixed(2), timeframe: '15-20 days', reliability: 85 },
                { name: 'Head and Shoulders', type: 'BEARISH', target: (currentPrice * 0.88).toFixed(2), timeframe: '10-15 days', reliability: 80 },
                { name: 'Double Bottom', type: 'BULLISH', target: (currentPrice * 1.12).toFixed(2), timeframe: '12-18 days', reliability: 75 },
                { name: 'Falling Wedge', type: 'BULLISH', target: (currentPrice * 1.10).toFixed(2), timeframe: '8-12 days', reliability: 70 },
                { name: 'Rising Wedge', type: 'BEARISH', target: (currentPrice * 0.92).toFixed(2), timeframe: '8-12 days', reliability: 70 },
                { name: 'Cup and Handle', type: 'BULLISH', target: (currentPrice * 1.18).toFixed(2), timeframe: '20-25 days', reliability: 85 },
                { name: 'Double Top', type: 'BEARISH', target: (currentPrice * 0.90).toFixed(2), timeframe: '10-15 days', reliability: 75 }
            ];
            
            // Select pattern based on technical indicators
            let selectedPattern;
            if (maTrend === 'BULLISH' && rsi < 60 && macdTrend === 'BULLISH') {
                selectedPattern = patterns[Math.floor(r(28) * 3)]; // Bullish patterns (0,2,3)
            } else if (maTrend === 'BEARISH' && rsi > 40 && macdTrend === 'BEARISH') {
                selectedPattern = patterns[1 + Math.floor(r(29) * 2) * 2]; // Bearish patterns (1,4,6)
            } else {
                selectedPattern = patterns[Math.floor(r(30) * patterns.length)];
            }
            
            // Calculate Technical Score (0-100)
            let technicalScore = 50;
            // RSI scoring
            if (rsi < 30) technicalScore += 20; // Oversold = buying opportunity
            else if (rsi > 70) technicalScore -= 20; // Overbought = selling signal
            else if (rsi >= 40 && rsi <= 60) technicalScore += 10; // Neutral zone
            
            // MA Crossover scoring
            if (maTrend === 'BULLISH') technicalScore += 15;
            else technicalScore -= 15;
            
            // MACD scoring
            if (macdTrend === 'BULLISH') technicalScore += 10;
            else technicalScore -= 10;
            
            // Volume scoring
            if (parseFloat(avgVolume) > 30) technicalScore += 5;
            
            technicalScore = Math.max(0, Math.min(100, technicalScore));
            
            return {
                symbol,
                name: STOCK_NAMES[symbol] || `${symbol} Ltd`,
                price: currentPrice.toFixed(2),
                currentPrice: currentPrice.toFixed(2),
                change: change.toFixed(2),
                changePercent: changePercent.toFixed(2),
                sector: sectorName,
                score: score,
                peRatio: (r(8) * 50 + 10).toFixed(2),
                marketCap: `â‚¹${(r(9) * 500 + 50).toFixed(0)}K Cr`,
                volume: `${(r(10) * 50 + 5).toFixed(1)}L`,
                recommendation: score >= 70 ? 'BUY' : score >= 40 ? 'HOLD' : 'SELL',
                targetPrice: score >= 70 ? (currentPrice * 1.15).toFixed(2) : score >= 40 ? (currentPrice * 1.05).toFixed(2) : (currentPrice * 0.92).toFixed(2),
                rsi: rsi.toFixed(2),
                macd: macd.toFixed(2),
                ema50: ema50.toFixed(2),
                ema200: ema200.toFixed(2),
                dayHigh: (currentPrice * 1.02).toFixed(2),
                dayLow: (currentPrice * 0.98).toFixed(2),
                week52High: (currentPrice * 1.15).toFixed(2),
                week52Low: (currentPrice * 0.85).toFixed(2),
                dividendYield: (r(14) * 3).toFixed(2) + '%',
                bookValue: (currentPrice * 0.8).toFixed(2),
                // Enhanced Technical Analysis Data
                technical: {
                    score: Math.round(technicalScore),
                    ma: {
                        ema50: ema50.toFixed(2),
                        ema200: ema200.toFixed(2),
                        crossover: maCrossover,
                        trend: maTrend,
                        strength: maStrength.toFixed(2)
                    },
                    macd: {
                        value: macd.toFixed(2),
                        signal: macdSignal.toFixed(2),
                        histogram: macdHistogram.toFixed(2),
                        signalType: macdSignalType,
                        trend: macdTrend
                    },
                    rsi: {
                        value: rsi.toFixed(2),
                        signal: rsiSignal,
                        zone: rsi < 30 ? 'Oversold' : rsi > 70 ? 'Overbought' : 'Neutral'
                    },
                    levels: {
                        support1,
                        support2,
                        resistance1,
                        resistance2
                    },
                    volume: {
                        current: `${(r(10) * 50 + 5).toFixed(1)}L`,
                        average: `${avgVolume}L`,
                        trend: volumeTrend
                    },
                    pattern: selectedPattern,
                    isRealData: realTechnicalData !== null // Flag to show if using real API data
                },
                // Options data
                options: {
                    sentiment: optionSentiment,
                    optionType: optionType,
                    confidence: confidence,
                    vix: vix.toFixed(2),
                    vixLevel: vix < 15 ? 'Low' : vix < 25 ? 'Normal' : vix < 35 ? 'High' : 'Very High',
                    strikes: {
                        itm: itm,
                        atm: atm,
                        otm: otm,
                        recommended: confidence > 70 ? otm : atm
                    },
                    premiums: {
                        // More realistic premiums based on moneyness and stock price
                        // ITM: 3-6% of stock price (higher intrinsic value)
                        call_itm: Math.max(Math.round(currentPrice * (0.04 + r(20) * 0.02)), 10),
                        // ATM: 2-4% of stock price (time value)
                        call_atm: Math.max(Math.round(currentPrice * (0.025 + r(21) * 0.015)), 8),
                        // OTM: 0.8-2% of stock price (speculative)
                        call_otm: Math.max(Math.round(currentPrice * (0.01 + r(22) * 0.01)), 5),
                        // PUT premiums slightly different
                        put_itm: Math.max(Math.round(currentPrice * (0.04 + r(23) * 0.02)), 10),
                        put_atm: Math.max(Math.round(currentPrice * (0.025 + r(24) * 0.015)), 8),
                        put_otm: Math.max(Math.round(currentPrice * (0.01 + r(25) * 0.01)), 5)
                    },
                    greeks: {
                        delta: (r(15) * 0.4 + 0.4).toFixed(2),
                        gamma: (r(16) * 0.05).toFixed(3),
                        theta: -(r(17) * 0.05).toFixed(2),
                        vega: (r(18) * 50 + 20).toFixed(2)
                    },
                    expiry: {
                        nearTerm: '30 Jan 2026',
                        monthly: '27 Feb 2026',
                        recommended: vix > 25 ? 'Near Term' : 'Monthly'
                    },
                    strategy: isBullish ? 'Long Call' : isBearish ? 'Long Put' : 'Long Straddle',
                    // Calculate expected target date based on price move and volatility
                    targetDate: (() => {
                        const today = new Date('2026-01-04');
                        const targetPrice = parseFloat(score >= 70 ? (currentPrice * 1.15) : score >= 40 ? (currentPrice * 1.05) : (currentPrice * 0.92));
                        const priceMove = Math.abs(targetPrice - currentPrice);
                        const movePercent = (priceMove / currentPrice) * 100;
                        
                        // Days to reach target based on move size and VIX
                        // Higher VIX = faster moves, larger moves = more days
                        let daysToTarget;
                        if (movePercent > 15) {
                            daysToTarget = vix > 25 ? 15 : 25; // Large move: 15-25 days
                        } else if (movePercent > 10) {
                            daysToTarget = vix > 25 ? 10 : 18; // Medium move: 10-18 days
                        } else if (movePercent > 5) {
                            daysToTarget = vix > 25 ? 7 : 12; // Small move: 7-12 days
                        } else {
                            daysToTarget = vix > 25 ? 5 : 8; // Minimal move: 5-8 days
                        }
                        
                        // Ensure target date is before expiry
                        const expiryDate = new Date(vix > 25 ? '2026-01-30' : '2026-02-27');
                        const targetDate = new Date(today);
                        targetDate.setDate(today.getDate() + daysToTarget);
                        
                        // If target date exceeds expiry, use 3-5 days before expiry
                        if (targetDate > expiryDate) {
                            targetDate.setTime(expiryDate.getTime() - (3 + Math.floor(r(26) * 2)) * 24 * 60 * 60 * 1000);
                        }
                        
                        return targetDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                    })()
                }
            };
        }

        // Data sanitization - ensure all values are safe to render
        function sanitizeStockForDisplay(stock) {
            if (!stock || typeof stock !== 'object') return null;
            
            // Create a sanitized copy
            const sanitized = {};
            
            // Convert all top-level properties to safe display values
            Object.keys(stock).forEach(key => {
                const value = stock[key];
                
                // Skip the options and technical objects - we'll handle them separately
                if (key === 'options' || key === 'technical') {
                    sanitized[key] = stock[key]; // Keep nested object as-is for internal use
                } else if (value === null || value === undefined) {
                    sanitized[key] = '';
                } else if (Array.isArray(value)) {
                    // Convert arrays to strings
                    sanitized[key] = JSON.stringify(value);
                } else if (typeof value === 'object') {
                    // Convert any unexpected objects to strings
                    sanitized[key] = JSON.stringify(value);
                } else if (typeof value === 'number') {
                    // Keep numbers as-is (React can render them)
                    sanitized[key] = value;
                } else if (typeof value === 'boolean') {
                    // Convert booleans to strings for display
                    sanitized[key] = value ? 'Yes' : 'No';
                } else {
                    // Keep strings and other primitives as-is
                    sanitized[key] = String(value);
                }
            });
            
            return sanitized;
        }
        
        // Error Boundary Component
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null, errorInfo: null };
            }
            
            static getDerivedStateFromError(error) {
                return { hasError: true };
            }
            
            componentDidCatch(error, errorInfo) {
                console.error('React Error Boundary caught:', error, errorInfo);
                this.setState({ error, errorInfo });
            }
            
            render() {
                if (this.state.hasError) {
                    return (
                        <div style={{ padding: '20px', background: '#fee', color: '#c00' }}>
                            <h2>Something went wrong</h2>
                            <details style={{ whiteSpace: 'pre-wrap' }}>
                                {this.state.error && this.state.error.toString()}
                                <br />
                                {this.state.errorInfo && this.state.errorInfo.componentStack}
                            </details>
                            <button onClick={() => window.location.reload()}>Reload App</button>
                        </div>
                    );
                }
                
                return this.props.children;
            }
        }

        function App() {
            const [screen, setScreen] = useState('home');
            const [selectedSector, setSelectedSector] = useState(null);
            const [selectedStock, setSelectedStock] = useState(null);
            const [activeTab, setActiveTab] = useState('overview');
            const [loading, setLoading] = useState(false);
            const [stockData, setStockData] = useState({});
            const [stocks, setStocks] = useState([]);
            const [isLoadingStocks, setIsLoadingStocks] = useState(false);
            const [showOptions, setShowOptions] = useState(true);
            const [apiError, setApiError] = useState(null);
            const [moslAccessToken, setMoslAccessToken] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [isSearching, setIsSearching] = useState(false);
            const [showPatternModal, setShowPatternModal] = useState(false);
            
            // Options Trading state
            const [topCalls, setTopCalls] = useState([]);
            const [topPuts, setTopPuts] = useState([]);
            const [optionsLoading, setOptionsLoading] = useState(false);
            
            // Load options data when screen changes to optionsTrading
            React.useEffect(() => {
                if (screen === 'optionsTrading' && showOptions) {
                    const loadOptionsData = async () => {
                        setOptionsLoading(true);
                        
                        // Generate top options recommendations across all stocks
                        const allStocks = [];
                        for (const sectorName of Object.keys(SECTORS)) {
                            for (const symbol of SECTORS[sectorName]) {
                                const stock = await generateMockStock(symbol, sectorName);
                                allStocks.push(stock);
                            }
                        }
                        
                        console.log('ðŸ“Š Total stocks generated:', allStocks.length);
                        console.log('ðŸ“‹ Sample stock:', allStocks[0]);
                        console.log('ðŸ” Has options?', allStocks[0]?.options);
                        
                        // Filter and rank best Call options (BULLISH sentiment)
                        const calls = allStocks
                            .filter(s => s.options && s.options.optionType === 'CALL')
                            .sort((a, b) => b.options.confidence - a.options.confidence)
                            .slice(0, 10);
                        
                        console.log('ðŸ“ž Top Calls found:', calls.length);
                        
                        // Filter and rank best Put options (BEARISH sentiment)
                        const puts = allStocks
                            .filter(s => s.options && s.options.optionType === 'PUT')
                            .sort((a, b) => b.options.confidence - a.options.confidence)
                            .slice(0, 10);
                        
                        console.log('ðŸ“‰ Top Puts found:', puts.length);
                        
                        setTopCalls(calls);
                        setTopPuts(puts);
                        setOptionsLoading(false);
                    };
                    
                    loadOptionsData();
                }
            }, [screen, showOptions]);
            
            // Fetch live NSE data for any stock
            async function fetchNSEStock(symbol) {
                try {
                    const response = await fetch(`https://www.nseindia.com/api/quote-equity?symbol=${symbol.toUpperCase()}`, {
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Mozilla/5.0'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to fetch stock data');
                    }
                    
                    const data = await response.json();
                    const priceInfo = data.priceInfo;
                    
                    if (!priceInfo) {
                        return null;
                    }
                    
                    return {
                        symbol: symbol.toUpperCase(),
                        price: priceInfo.lastPrice,
                        change: priceInfo.change,
                        changePercent: priceInfo.pChange,
                        dayHigh: priceInfo.intraDayHighLow?.max,
                        dayLow: priceInfo.intraDayHighLow?.min,
                        week52High: priceInfo.weekHighLow?.max,
                        week52Low: priceInfo.weekHighLow?.min
                    };
                } catch (error) {
                    console.error(`Error fetching ${symbol}:`, error);
                    return null;
                }
            }
            
            // Search handler
            const handleSearch = async (query) => {
                setSearchQuery(query);
                
                if (query.length < 2) {
                    setSearchResults([]);
                    return;
                }
                
                setIsSearching(true);
                
                // Check if stock exists in our database or generate it
                const symbolUpper = query.toUpperCase().trim();
                
                // Check if it's in REALISTIC_PRICES or STOCK_NAMES
                const stockExists = REALISTIC_PRICES[symbolUpper] || STOCK_NAMES[symbolUpper];
                
                if (stockExists || symbolUpper.length >= 3) {
                    // Generate stock data (will use real price if available)
                    const stock = generateMockStock(symbolUpper, 'Search');
                    const sanitized = sanitizeStockForDisplay(stock);
                    setSearchResults([sanitized]);
                    setSelectedStock(sanitized);
                    setScreen('stockDetail');
                } else {
                    setSearchResults([]);
                    alert(`Please enter a valid NSE stock symbol (e.g., RELIANCE, TCS, INFY)`);
                }
                
                setIsSearching(false);
            };
            
            // Fetch NSE Top Performers (Top Gainers, Losers, Most Active)
            async function fetchNSETopPerformers() {
                try {
                    // Note: NSE API requires cookies/headers, might not work directly from browser
                    // For now, we'll filter from our existing stocks with real prices
                    const allStocksWithPrices = [];
                    
                    Object.keys(REALISTIC_PRICES).forEach(symbol => {
                        const stock = generateMockStock(symbol, 'Multiple');
                        if (stock) {
                            allStocksWithPrices.push(stock);
                        }
                    });
                    
                    // Sort by change percent to get top gainers and losers
                    const topGainers = [...allStocksWithPrices]
                        .filter(s => parseFloat(s.changePercent) > 0)
                        .sort((a, b) => parseFloat(b.changePercent) - parseFloat(a.changePercent))
                        .slice(0, 20);
                    
                    const topLosers = [...allStocksWithPrices]
                        .filter(s => parseFloat(s.changePercent) < 0)
                        .sort((a, b) => parseFloat(a.changePercent) - parseFloat(b.changePercent))
                        .slice(0, 20);
                    
                    const mostActive = [...allStocksWithPrices]
                        .sort((a, b) => Math.abs(parseFloat(b.changePercent)) - Math.abs(parseFloat(a.changePercent)))
                        .slice(0, 30);
                    
                    return { topGainers, topLosers, mostActive };
                } catch (error) {
                    console.error('Error fetching top performers:', error);
                    return { topGainers: [], topLosers: [], mostActive: [] };
                }
            }
            
            // MOSL API Configuration
            const MOSL_API_KEY = 'sTHWtNb6bn5bGiY';
            const MOSL_SECRET_KEY = '3d622c3d-7f36-43ee-8776-9056e454324a';
            
            // MOSL Authentication - get access token via proxy
            async function getMOSLAccessToken() {
                try {
                    console.log('ðŸ” Authenticating via Render proxy...');
                    
                    // Use proxy server instead of direct MOSL API
                    const proxyUrl = 'https://nse-stock-analyzer.onrender.com';
                    
                    const response = await fetch(`${proxyUrl}/`, {
                        method: 'GET'
                    });
                    
                    if (!response.ok) {
                        console.error('Proxy health check failed:', response.status);
                        console.warn('ðŸ“Š Using mock data with realistic NSE prices');
                        return null;
                    }
                    
                    const data = await response.json();
                    
                    if (data.status === 'ok' && data.authenticated) {
                        console.log('âœ… Proxy authenticated with MOSL API');
                        setMoslAccessToken('proxy-authenticated');
                        return 'proxy-authenticated';
                    } else {
                        console.warn('Proxy available but MOSL auth failed');
                        console.warn('ðŸ“Š Using mock data with realistic NSE prices');
                        return null;
                    }
                    
                    /* Uncomment when proxy is deployed:
                    const authUrl = 'https://api.motilaloswal.com/rest/auth/v1/login';
                    
                    const response = await fetch(authUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': MOSL_API_KEY
                        },
                        body: JSON.stringify({
                            'secretKey': MOSL_SECRET_KEY
                        })
                    });
                    
                    if (!response.ok) {
                        console.error('MOSL Authentication failed:', response.status);
                        return null;
                    }
                    
                    const data = await response.json();
                    
                    if (data && data.accessToken) {
                        sessionStorage.setItem('mosl_access_token', data.accessToken);
                        setMoslAccessToken(data.accessToken);
                        console.log('âœ… MOSL API authenticated successfully');
                        return data.accessToken;
                    } else {
                        console.error('No access token in response');
                        return null;
                    }
                    */
                } catch (error) {
                    console.error('MOSL Authentication error:', error);
                    return null;
                }
            }
            
            // Initialize MOSL API on app load
            useEffect(() => {
                // Check if we have token in sessionStorage
                const savedToken = sessionStorage.getItem('mosl_access_token');
                if (savedToken) {
                    setMoslAccessToken(savedToken);
                    console.log('âœ… Using saved MOSL token');
                } else {
                    // Try to authenticate via proxy
                    console.log('ðŸ” Authenticating with MOSL API via Render proxy...');
                    getMOSLAccessToken();
                }
            }, []);
            
            // Load stocks when sector changes - with MOSL API
            useEffect(() => {
                if (screen === 'stockList' && selectedSector) {
                    async function loadStocks() {
                        setIsLoadingStocks(true);
                        setApiError(null);
                        const symbols = SECTORS[selectedSector] || [];
                        
                        if (symbols.length === 0) {
                            console.error(`No symbols found for sector: ${selectedSector}`);
                            setStocks([]);
                            setIsLoadingStocks(false);
                            return;
                        }
                        
                        // Try to fetch real data from MOSL API and real technical indicators
                        const results = [];
                        for (const symbol of symbols) {
                            let realData = null;
                            
                            if (moslAccessToken) {
                                realData = await fetchMOSLStockData(symbol, moslAccessToken);
                            }
                            
                            // Generate stock data with real technical indicators (only for first 10 stocks to save API quota)
                            const useRealTechnicals = symbols.indexOf(symbol) < 10;
                            const mockData = await generateMockStock(symbol, selectedSector, useRealTechnicals);
                            
                            if (realData) {
                                // Got real data - merge with mock for additional fields
                                // Preserve technical object from mock data
                                results.push({
                                    ...mockData,
                                    ...realData,
                                    name: STOCK_NAMES[symbol] || `${symbol} Ltd`,
                                    sector: selectedSector,
                                    recommendation: realData.score >= 70 ? 'BUY' : realData.score >= 40 ? 'HOLD' : 'SELL',
                                    technical: mockData.technical, // Preserve technical analysis from mock (or real if fetched)
                                    options: mockData.options, // Preserve options data from mock
                                    isRealData: true
                                });
                            } else {
                                // Use mock data
                                results.push({
                                    ...mockData,
                                    name: STOCK_NAMES[symbol] || `${symbol} Ltd`,
                                    sector: selectedSector,
                                    recommendation: mockData.score >= 70 ? 'BUY' : mockData.score >= 40 ? 'HOLD' : 'SELL',
                                    isRealData: false
                                });
                            }
                            
                            // Small delay between calls
                            await new Promise(resolve => setTimeout(resolve, 300));
                        }
                        
                        const sortedStocks = results.sort((a, b) => b.score - a.score);
                        setStocks(sortedStocks.map(sanitizeStockForDisplay).filter(s => s !== null));
                        setIsLoadingStocks(false);
                    }
                    
                    loadStocks();
                }
            }, [screen, selectedSector, moslAccessToken]);

            // Fetch real stock data from MOSL API via proxy
            async function fetchMOSLStockData(symbol, accessToken) {
                try {
                    // Use proxy endpoint instead of direct MOSL API
                    const proxyUrl = 'https://nse-stock-analyzer.onrender.com';
                    const apiUrl = `${proxyUrl}/api/quote/${symbol}?exchange=NSE`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'GET'
                    });
                    
                    if (!response.ok) {
                        console.error(`MOSL API Error ${response.status} for ${symbol}`);
                        return null;
                    }
                    
                    const data = await response.json();
                    
                    if (!data || !data.ltp) {
                        console.error(`No price data for ${symbol}`);
                        return null;
                    }
                    
                    const currentPrice = parseFloat(data.ltp);
                    const previousClose = parseFloat(data.close || data.prev_close);
                    const dayHigh = parseFloat(data.high);
                    const dayLow = parseFloat(data.low);
                    const volume = data.volume;
                    
                    const change = currentPrice - previousClose;
                    const changePercent = (change / previousClose) * 100;
                    
                    // Calculate RSI (simplified)
                    let rsi = 50;
                    if (changePercent > 5) rsi = 75;
                    else if (changePercent > 2) rsi = 65;
                    else if (changePercent > 0) rsi = 55;
                    else if (changePercent > -2) rsi = 45;
                    else if (changePercent > -5) rsi = 35;
                    else rsi = 25;
                    
                    // Calculate score
                    let score = 50;
                    if (changePercent > 3) score += 20;
                    else if (changePercent > 1) score += 10;
                    else if (changePercent < -3) score -= 20;
                    else if (changePercent < -1) score -= 10;
                    
                    if (rsi < 30) score += 15;
                    else if (rsi > 70) score -= 15;
                    else if (rsi > 60) score += 5;
                    
                    score = Math.max(0, Math.min(100, score));
                    
                    return {
                        symbol,
                        currentPrice: currentPrice.toFixed(2),
                        price: currentPrice.toFixed(2),
                        change: change.toFixed(2),
                        changePercent: changePercent.toFixed(2),
                        dayHigh: dayHigh.toFixed(2),
                        dayLow: dayLow.toFixed(2),
                        week52High: (data.week52_high || currentPrice * 1.15).toFixed(2),
                        week52Low: (data.week52_low || currentPrice * 0.85).toFixed(2),
                        volume: volume ? (volume / 100000).toFixed(1) + 'L' : 'N/A',
                        rsi: rsi.toFixed(2),
                        score: Math.round(score)
                    };
                } catch (error) {
                    console.error(`Error fetching ${symbol} from MOSL:`, error);
                    return null;
                }
            }

            const handleSectorClick = (sectorName) => {
                console.log(`ðŸ¢ Sector clicked: ${sectorName}`);
                setSelectedSector(sectorName);
                setScreen('stockList');
                setStocks([]); // Clear previous stocks
            };

            const handleStockClick = (stock) => {
                console.log(`ðŸ“ˆ Stock clicked:`, stock);
                const sanitized = sanitizeStockForDisplay(stock);
                console.log(`âœ… Setting selectedStock to:`, sanitized.symbol);
                setSelectedStock(sanitized);
                setScreen('stockDetail');
                setActiveTab('overview'); // Reset to overview tab
                console.log(`âœ… Screen changed to: stockDetail`);
            };

            const handleBack = () => {
                console.log(`â¬…ï¸ Back button clicked from screen: ${screen}`);
                if (screen === 'stockDetail') {
                    setScreen('stockList');
                    setActiveTab('overview');
                } else {
                    setScreen('home');
                    setSelectedSector(null);
                    setStocks([]);
                }
            };
            
            // Load category stocks - useEffect must be at top level, not inside conditional
            React.useEffect(() => {
                if (screen !== 'category' || !selectedSector) return;
                
                const loadCategoryStocks = async () => {
                    setIsLoadingStocks(true);
                    
                    try {
                        // Get all stocks with real prices
                        const allStockSymbols = Object.values(SECTORS || {}).flat();
                        const categoryStocks = [];
                        
                        if (!allStockSymbols || allStockSymbols.length === 0) {
                            console.error('No stock symbols found in SECTORS');
                            setStocks([]);
                            setIsLoadingStocks(false);
                            return;
                        }
                        
                        for (const symbol of allStockSymbols) {
                            if (!symbol) continue;
                            if (REALISTIC_PRICES[symbol]) {
                                // Use real technical data for "Technically Strong" category
                                const useRealTechnicals = selectedSector === 'Technically Strong';
                                const stock = await generateMockStock(symbol, 'Multiple', useRealTechnicals);
                                
                                // Add category-specific scoring
                                if (selectedSector === 'Target Oriented') {
                                    // Stocks with clear support/resistance levels
                                    stock.targetScore = stock.score;
                                    // Target price based on recommendation
                                    stock.targetPrice = stock.recommendation === 'BUY' ? 
                                        (parseFloat(stock.price) * 1.15).toFixed(2) : 
                                        stock.recommendation === 'HOLD' ? 
                                        (parseFloat(stock.price) * 1.05).toFixed(2) :
                                        (parseFloat(stock.price) * 0.92).toFixed(2);
                                    stock.stopLoss = (parseFloat(stock.price) * 0.95).toFixed(2);
                                } else if (selectedSector === 'Swing Stocks') {
                                    // High momentum stocks
                                    const momentum = parseFloat(stock.changePercent);
                                    stock.momentumScore = momentum > 3 ? 90 : momentum > 2 ? 80 : momentum > 1 ? 70 : 50;
                                    // Target price based on recommendation
                                    stock.targetPrice = stock.recommendation === 'BUY' ? 
                                        (parseFloat(stock.price) * 1.10).toFixed(2) : 
                                        stock.recommendation === 'HOLD' ? 
                                        (parseFloat(stock.price) * 1.05).toFixed(2) :
                                        (parseFloat(stock.price) * 0.95).toFixed(2);
                                    stock.stopLoss = (parseFloat(stock.price) * 0.97).toFixed(2);
                                } else if (selectedSector === 'Fundamentally Strong') {
                                    // Good P/E, low debt
                                    const pe = parseFloat(stock.peRatio);
                                    stock.fundamentalScore = pe < 20 ? 90 : pe < 30 ? 75 : 60;
                                    // Target price based on recommendation
                                    stock.targetPrice = stock.recommendation === 'BUY' ? 
                                        (parseFloat(stock.price) * 1.20).toFixed(2) : 
                                        stock.recommendation === 'HOLD' ? 
                                        (parseFloat(stock.price) * 1.08).toFixed(2) :
                                        (parseFloat(stock.price) * 0.90).toFixed(2);
                                    stock.stopLoss = (parseFloat(stock.price) * 0.93).toFixed(2);
                                } else if (selectedSector === 'Technically Strong') {
                                    // Use comprehensive technical analysis score
                                    stock.technicalScore = stock.technical?.score || 50;
                                    // Use pattern-based target if available
                                    if (stock.technical?.pattern) {
                                        stock.targetPrice = stock.technical.pattern.target;
                                        stock.patternDays = stock.technical.pattern.timeframe;
                                    } else {
                                        stock.targetPrice = stock.recommendation === 'BUY' ? 
                                            (parseFloat(stock.price) * 1.12).toFixed(2) : 
                                            stock.recommendation === 'HOLD' ? 
                                            (parseFloat(stock.price) * 1.05).toFixed(2) :
                                            (parseFloat(stock.price) * 0.92).toFixed(2);
                                    }
                                    stock.stopLoss = (parseFloat(stock.price) * 0.96).toFixed(2);
                                } else if (selectedSector === 'Hot Stocks Today') {
                                    // Top movers
                                    stock.dayMoveScore = Math.abs(parseFloat(stock.changePercent)) * 10;
                                    // Target price based on current momentum AND recommendation
                                    const baseMultiplier = parseFloat(stock.changePercent) > 0 ? 1.08 : 0.95;
                                    stock.targetPrice = stock.recommendation === 'BUY' ? 
                                        (parseFloat(stock.price) * baseMultiplier).toFixed(2) : 
                                        stock.recommendation === 'HOLD' ? 
                                        (parseFloat(stock.price) * 1.03).toFixed(2) :
                                        (parseFloat(stock.price) * 0.93).toFixed(2);
                                    stock.stopLoss = (parseFloat(stock.price) * 0.97).toFixed(2);
                                }
                                
                                categoryStocks.push(stock);
                            }
                        }
                        
                        // Sort based on category
                        if (selectedSector === 'Target Oriented') {
                            categoryStocks.sort((a, b) => (b.targetScore || 0) - (a.targetScore || 0));
                        } else if (selectedSector === 'Swing Stocks') {
                            categoryStocks.sort((a, b) => (b.momentumScore || 0) - (a.momentumScore || 0));
                        } else if (selectedSector === 'Fundamentally Strong') {
                            categoryStocks.sort((a, b) => (b.fundamentalScore || 0) - (a.fundamentalScore || 0));
                        } else if (selectedSector === 'Technically Strong') {
                            categoryStocks.sort((a, b) => (b.technicalScore || 0) - (a.technicalScore || 0));
                        } else if (selectedSector === 'Hot Stocks Today') {
                            categoryStocks.sort((a, b) => (b.dayMoveScore || 0) - (a.dayMoveScore || 0));
                        }
                        
                        setStocks(categoryStocks.slice(0, 50).map(sanitizeStockForDisplay).filter(s => s !== null)); // Top 50 stocks
                    } catch (error) {
                        console.error('Error loading category stocks:', error);
                        setStocks([]);
                    } finally {
                        setIsLoadingStocks(false);
                    }
                };
                
                loadCategoryStocks();
            }, [screen, selectedSector]);

            if (screen === 'home') {
                return (
                    <div>
                        <div className="header">
                            <h1>ðŸ“ˆ NSE Stock Analyzer</h1>
                            <p>AI-Powered Multi-Strategy Analysis</p>
                        </div>
                        
                        <div className="sectors">
                            {/* Main Strategy Categories */}
                            <div 
                                className="sector-card"
                                style={{ 
                                    borderLeftColor: '#10b981',
                                    background: 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)'
                                }}
                                onClick={() => {
                                    setScreen('category');
                                    setSelectedSector('Target Oriented');
                                }}
                            >
                                <h3>ðŸŽ¯ Target Oriented Stocks</h3>
                                <p>Clear price targets with stop loss</p>
                                <span className="stock-count" style={{ background: '#10b981', color: 'white' }}>
                                    High probability trades
                                </span>
                            </div>
                            
                            <div 
                                className="sector-card"
                                style={{ 
                                    borderLeftColor: '#f59e0b',
                                    background: 'linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%)'
                                }}
                                onClick={() => {
                                    setScreen('category');
                                    setSelectedSector('Swing Stocks');
                                }}
                            >
                                <h3>ðŸ“ˆ Swing Stocks</h3>
                                <p>High momentum trending stocks</p>
                                <span className="stock-count" style={{ background: '#f59e0b', color: 'white' }}>
                                    Riding the wave
                                </span>
                            </div>
                            
                            <div 
                                className="sector-card"
                                style={{ 
                                    borderLeftColor: '#3b82f6',
                                    background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)'
                                }}
                                onClick={() => {
                                    setScreen('category');
                                    setSelectedSector('Fundamentally Strong');
                                }}
                            >
                                <h3>ðŸ’Ž Fundamentally Strong</h3>
                                <p>Best P/E, ROE, debt ratios</p>
                                <span className="stock-count" style={{ background: '#3b82f6', color: 'white' }}>
                                    Quality picks
                                </span>
                            </div>
                            
                            <div 
                                className="sector-card"
                                style={{ 
                                    borderLeftColor: '#8b5cf6',
                                    background: 'linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%)'
                                }}
                                onClick={() => {
                                    setScreen('category');
                                    setSelectedSector('Technically Strong');
                                }}
                            >
                                <h3>ðŸ“Š Technically Strong</h3>
                                <p>RSI, MACD, breakout patterns</p>
                                <span className="stock-count" style={{ background: '#8b5cf6', color: 'white' }}>
                                    Chart winners
                                </span>
                            </div>
                            
                            <div 
                                className="sector-card"
                                style={{ 
                                    borderLeftColor: '#ef4444',
                                    background: 'linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)'
                                }}
                                onClick={() => {
                                    setScreen('category');
                                    setSelectedSector('Hot Stocks Today');
                                }}
                            >
                                <h3>ðŸ”¥ Hot Stocks Today</h3>
                                <p>Top gainers, losers, most active</p>
                                <span className="stock-count" style={{ background: '#ef4444', color: 'white' }}>
                                    Live market movers
                                </span>
                            </div>
                            
                            {/* Options Trading Card - Only visible 9:00-9:20 AM IST */}
                            {showOptions ? (
                                <div 
                                    className="sector-card"
                                    style={{ 
                                        borderLeftColor: '#FF6B35',
                                        background: 'linear-gradient(135deg, #fff5f2 0%, #ffe8e0 100%)'
                                    }}
                                    onClick={() => {
                                        setScreen('optionsTrading');
                                        setSelectedSector('Options Trading');
                                    }}
                                >
                                    <h3>ðŸŽ¯ Options Trading</h3>
                                    <p>Call & Put with entry/target/SL</p>
                                    <span className="stock-count" style={{ background: '#FF6B35', color: 'white' }}>
                                        Top 20 trades â€¢ 9:00-9:20 AM
                                    </span>
                                </div>
                            ) : (
                                <div 
                                    className="sector-card"
                                    style={{ 
                                        borderLeftColor: '#999',
                                        background: 'linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)',
                                        opacity: 0.7,
                                        cursor: 'not-allowed'
                                    }}
                                >
                                    <h3>ðŸ• Options Trading</h3>
                                    <p>Available tomorrow 9:00-9:20 AM</p>
                                    <span className="stock-count" style={{ background: '#999', color: 'white' }}>
                                        Morning window only
                                    </span>
                                </div>
                            )}
                            
                            {/* Browse by Sectors - Collapsible */}
                            <div 
                                className="sector-card"
                                style={{ 
                                    borderLeftColor: '#64748b',
                                    background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',
                                    gridColumn: '1 / -1'
                                }}
                                onClick={() => {
                                    setScreen('sectors');
                                }}
                            >
                                <h3>ðŸ“‘ Browse by Sectors</h3>
                                <p>View 18 sectors with curated stocks</p>
                                <span className="stock-count" style={{ background: '#64748b', color: 'white' }}>
                                    160 stocks across 18 sectors
                                </span>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Category Screen - Target Oriented, Swing, Fundamental, Technical, Hot Stocks
            if (screen === 'category') {
                console.log(`ðŸ–¥ï¸ Rendering category screen:`, selectedSector);
                return (
                    <div key={`category-${selectedSector}`}>
                        <div className="header">
                            <h1>{selectedSector}</h1>
                            <p>Top 50 stocks with targets & stop loss</p>
                        </div>
                        <button className="back-button" onClick={handleBack}>
                            â† Back to Home
                        </button>
                        {isLoadingStocks ? (
                            <div style={{ textAlign: 'center', padding: '40px', color: '#666' }}>
                                Loading stocks...
                            </div>
                        ) : (
                            <div className="stock-list">
                                {stocks.map(stock => (
                                    <div 
                                        key={stock.symbol} 
                                        className="stock-item"
                                        onClick={() => {
                                            console.log(`ðŸŽ¯ Category stock clicked:`, stock.symbol);
                                            const sanitized = sanitizeStockForDisplay(stock);
                                            console.log(`âœ… Setting selectedStock to:`, sanitized.symbol);
                                            setSelectedStock(sanitized);
                                            setActiveTab('overview');
                                            setScreen('stockDetail');
                                            console.log(`âœ… Screen changed to: stockDetail`);
                                        }}
                                    >
                                        <div className="stock-header">
                                            <div>
                                                <div className="stock-symbol">{stock.symbol || 'N/A'}</div>
                                                <div className="stock-name">{String(STOCK_NAMES[stock.symbol] || stock.name || stock.symbol || 'Unknown')}</div>
                                                <div style={{ fontSize: '11px', color: '#888', marginTop: '2px' }}>
                                                    Sector: {stock.sector || 'N/A'}
                                                </div>
                                            </div>
                                            <div style={{ textAlign: 'right' }}>
                                                <div className="stock-price">â‚¹{stock.price || '0'}</div>
                                                <div className={`stock-change ${parseFloat(stock.change || 0) >= 0 ? 'positive' : 'negative'}`}>
                                                    {parseFloat(stock.change || 0) >= 0 ? 'â†‘' : 'â†“'} {Math.abs(parseFloat(stock.change || 0)).toFixed(2)} ({parseFloat(stock.changePercent || 0).toFixed(2)}%)
                                                </div>
                                            </div>
                                        </div>
                                        <div style={{ 
                                            display: 'grid', 
                                            gridTemplateColumns: '1fr 1fr 1fr', 
                                            gap: '8px', 
                                            marginTop: '10px',
                                            paddingTop: '10px',
                                            borderTop: '1px solid #e0e0e0'
                                        }}>
                                            <div style={{ textAlign: 'center' }}>
                                                <div style={{ fontSize: '11px', color: '#666' }}>Target</div>
                                                <div style={{ fontSize: '14px', fontWeight: 'bold', color: '#10b981' }}>
                                                    â‚¹{stock.targetPrice || '0'}
                                                </div>
                                            </div>
                                            <div style={{ textAlign: 'center' }}>
                                                <div style={{ fontSize: '11px', color: '#666' }}>Stop Loss</div>
                                                <div style={{ fontSize: '14px', fontWeight: 'bold', color: '#ef4444' }}>
                                                    â‚¹{stock.stopLoss || '0'}
                                                </div>
                                            </div>
                                            <div style={{ textAlign: 'center' }}>
                                                <div style={{ fontSize: '11px', color: '#666' }}>Score</div>
                                                <div style={{ fontSize: '14px', fontWeight: 'bold', color: '#3b82f6' }}>
                                                    {stock.score || 0}/100
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            }
            
            // Sectors Browse Screen
            if (screen === 'sectors') {
                return (
                    <div>
                        <div className="header">
                            <h1>ðŸ“‘ Browse by Sectors</h1>
                            <p>160 curated stocks across 18 sectors</p>
                        </div>
                        <button className="back-button" onClick={handleBack}>
                            â† Back to Home
                        </button>
                        <div className="sectors">
                            {Object.keys(SECTORS).map(sectorName => (
                                <div 
                                    key={sectorName}
                                    className="sector-card"
                                    style={{ borderLeftColor: SECTOR_COLORS[sectorName] }}
                                    onClick={() => handleSectorClick(sectorName)}
                                >
                                    <h3>{sectorName}</h3>
                                    <p>View top performing stocks</p>
                                    <span className="stock-count">{SECTORS[sectorName].length} stocks</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }
            
            // Options Trading Screen - Dedicated section for Call/Put recommendations
            if (screen === 'optionsTrading') {
                // Check if options window is active
                if (!showOptions) {
                    return (
                        <div>
                            <div className="header">
                                <h1>ðŸ• Options Trading</h1>
                                <p>Available during market opening window only</p>
                            </div>
                            <button className="back-button" onClick={handleBack}>
                                â† Back to Home
                            </button>
                            <div className="stock-list">
                                <div style={{
                                    background: 'white',
                                    borderRadius: '12px',
                                    padding: '40px',
                                    margin: '20px',
                                    textAlign: 'center',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                                }}>
                                    <h2 style={{ color: '#FF6B35', marginBottom: '20px' }}>â° Options Window Closed</h2>
                                    <p style={{ fontSize: '16px', color: '#666', lineHeight: '1.6' }}>
                                        Options trading recommendations are available only during the morning window:<br/>
                                        <strong style={{ color: '#333', fontSize: '20px' }}>9:00 AM - 9:20 AM IST</strong>
                                    </p>
                                    <p style={{ fontSize: '14px', color: '#999', marginTop: '20px' }}>
                                        Please visit during the window to view pre-market Call and Put recommendations.
                                    </p>
                                </div>
                            </div>
                        </div>
                }
                
                // Show loading state while data is being fetched
                if (optionsLoading) {
                    return (
                        <div>
                            <div className="header">
                                <h1>ðŸŽ¯ Options Trading</h1>
                                <p>Loading recommendations...</p>
                            </div>
                            <button className="back-button" onClick={handleBack}>
                                â† Back to Home
                            </button>
                            <div className="stock-list">
                                <div style={{
                                    background: 'white',
                                    borderRadius: '12px',
                                    padding: '40px',
                                    margin: '20px',
                                    textAlign: 'center',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                                }}>
                                    <div style={{ fontSize: '48px', marginBottom: '20px' }}>â³</div>
                                    <h2 style={{ color: '#4CAF50', marginBottom: '10px' }}>Analyzing Market Data...</h2>
                                    <p style={{ fontSize: '14px', color: '#666' }}>Generating Call and Put recommendations</p>
                                </div>
                            </div>
                        </div>
                    );
                }
                
                return (
                    <div>
                        <div className="header">
                            <h1>ðŸŽ¯ Options Trading</h1>
                            <p>Pre-Market Call & Put Recommendations</p>
                            
                            {/* Prominent Date & Buy Timing */}
                            <div style={{
                                background: 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)',
                                padding: '15px 20px',
                                borderRadius: '12px',
                                marginTop: '15px',
                                boxShadow: '0 4px 12px rgba(76, 175, 80, 0.4)',
                                border: '2px solid rgba(255,255,255,0.3)'
                            }}>
                                <div style={{ 
                                    fontSize: '18px', 
                                    fontWeight: 'bold', 
                                    color: '#fff', 
                                    marginBottom: '8px',
                                    textAlign: 'center'
                                }}>
                                    ðŸ“… {new Date().toLocaleDateString('en-IN', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}
                                </div>
                                <div style={{
                                    fontSize: '14px',
                                    color: '#fff',
                                    textAlign: 'center',
                                    fontWeight: '600',
                                    marginTop: '5px'
                                }}>
                                    â° Buy These Options: Tomorrow Morning (After Market Opens)
                                </div>
                            </div>
                            
                            <div style={{
                                background: 'rgba(255,255,255,0.1)',
                                padding: '10px 20px',
                                borderRadius: '8px',
                                marginTop: '10px',
                                fontSize: '13px',
                                color: '#fff'
                            }}>
                                â“˜ Analysis based on previous day's closing prices â€¢ Not investment advice â€¢ Trade at your own risk
                            </div>
                        </div>
                        <button className="back-button" onClick={handleBack}>
                            â† Back to Home
                        </button>
                        
                        <div className="stock-list">
                            {/* Call Options Section */}
                            <div style={{ 
                                background: 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)',
                                padding: '15px',
                                borderRadius: '12px',
                                marginBottom: '20px',
                                border: '2px solid #4CAF50'
                            }}>
                                <h2 style={{ 
                                    fontSize: '20px', 
                                    color: '#2e7d32', 
                                    marginBottom: '5px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}>
                                    ðŸŸ¢ Top Call Options
                                </h2>
                                
                                {topCalls.map((stock, index) => (
                                    <div 
                                        key={stock.symbol}
                                        className="options-trade-card"
                                        style={{ 
                                            background: 'white',
                                            borderRadius: '10px',
                                            padding: '15px',
                                            marginBottom: '12px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                            borderLeft: '4px solid #4CAF50'
                                        }}
                                    >
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '10px' }}>
                                            <div>
                                                <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#333' }}>
                                                    {stock.symbol || 'N/A'}
                                                </div>
                                                <div style={{ fontSize: '13px', color: '#666' }}>
                                                    {String(stock.name || stock.symbol || 'Unknown')}
                                                </div>
                                            </div>
                                            <div style={{ 
                                                background: '#4CAF50',
                                                color: 'white',
                                                padding: '6px 12px',
                                                borderRadius: '20px',
                                                fontSize: '13px',
                                                fontWeight: 'bold'
                                            }}>
                                                {stock.options.confidence}% Sure
                                            </div>
                                        </div>
                                        
                                        <div style={{ 
                                            display: 'grid',
                                            gridTemplateColumns: '1fr 1fr',
                                            gap: '10px',
                                            marginBottom: '12px'
                                        }}>
                                            <div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>Current Price</div>
                                                <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#333' }}>
                                                    â‚¹{stock.price}
                                                </div>
                                            </div>
                                            <div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>Strike Price</div>
                                                <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#333' }}>
                                                    â‚¹{stock.options.strikes.recommended}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style={{ 
                                            background: '#f8f9fa',
                                            padding: '12px',
                                            borderRadius: '8px',
                                            marginBottom: '10px'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Entry (Premium):</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#2e7d32' }}>
                                                    â‚¹{stock.options.strikes.recommended === stock.options.strikes.otm 
                                                        ? stock.options.premiums.call_otm
                                                        : stock.options.strikes.recommended === stock.options.strikes.atm
                                                        ? stock.options.premiums.call_atm
                                                        : stock.options.premiums.call_itm}
                                                </span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Target:</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#4CAF50' }}>
                                                    â‚¹{(() => {
                                                        const currentPrice = parseFloat(stock.price);
                                                        const targetPrice = parseFloat(stock.targetPrice);
                                                        const priceMove = targetPrice - currentPrice;
                                                        const strikePrice = stock.options.strikes.recommended;
                                                        const premium = parseFloat(stock.options.strikes.recommended === stock.options.strikes.otm 
                                                            ? stock.options.premiums.call_otm
                                                            : stock.options.strikes.recommended === stock.options.strikes.atm
                                                            ? stock.options.premiums.call_atm
                                                            : stock.options.premiums.call_itm);
                                                        
                                                        // If stock reaches target, option intrinsic value = max(0, targetPrice - strikePrice)
                                                        const intrinsicValue = Math.max(0, targetPrice - strikePrice);
                                                        // Add time value (30-50% of intrinsic for near-term expiry)
                                                        const timeValue = intrinsicValue * 0.4;
                                                        const targetPremium = Math.max(intrinsicValue + timeValue, premium * 1.2); // At least 20% gain
                                                        return targetPremium.toFixed(2);
                                                    })()}
                                                </span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Expected By:</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#1976d2' }}>
                                                    ðŸ“… {stock.options.targetDate}
                                                </span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Stop Loss (Max 5%):</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#d32f2f' }}>
                                                    â‚¹{(() => {
                                                        const premium = parseFloat(stock.options.strikes.recommended === stock.options.strikes.otm 
                                                            ? stock.options.premiums.call_otm
                                                            : stock.options.strikes.recommended === stock.options.strikes.atm
                                                            ? stock.options.premiums.call_atm
                                                            : stock.options.premiums.call_itm);
                                                        const maxStopLoss = premium * 0.95;
                                                        return maxStopLoss.toFixed(2);
                                                    })()}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '8px' }}>
                                            ðŸ“… Expiry: {stock.options.expiry.recommended} | VIX: {stock.options.vix}
                                        </div>
                                        
                                        <div style={{ fontSize: '13px', color: '#2e7d32', fontWeight: '600' }}>
                                            ðŸ’¡ {stock.options.strategy}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            {/* Put Options Section */}
                            <div style={{ 
                                background: 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)',
                                padding: '15px',
                                borderRadius: '12px',
                                marginBottom: '20px',
                                border: '2px solid #f44336'
                            }}>
                                <h2 style={{ 
                                    fontSize: '20px', 
                                    color: '#c62828', 
                                    marginBottom: '5px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}>
                                    ðŸ”´ Top Put Options
                                </h2>
                                
                                {topPuts.map((stock, index) => (
                                    <div 
                                        key={stock.symbol}
                                        className="options-trade-card"
                                        style={{ 
                                            background: 'white',
                                            borderRadius: '10px',
                                            padding: '15px',
                                            marginBottom: '12px',
                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                            borderLeft: '4px solid #f44336'
                                        }}
                                    >
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '10px' }}>
                                            <div>
                                                <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#333' }}>
                                                    {stock.symbol || 'N/A'}
                                                </div>
                                                <div style={{ fontSize: '13px', color: '#666' }}>
                                                    {String(stock.name || stock.symbol || 'Unknown')}
                                                </div>
                                            </div>
                                            <div style={{ 
                                                background: '#f44336',
                                                color: 'white',
                                                padding: '6px 12px',
                                                borderRadius: '20px',
                                                fontSize: '13px',
                                                fontWeight: 'bold'
                                            }}>
                                                {stock.options.confidence}% Sure
                                            </div>
                                        </div>
                                        
                                        <div style={{ 
                                            display: 'grid',
                                            gridTemplateColumns: '1fr 1fr',
                                            gap: '10px',
                                            marginBottom: '12px'
                                        }}>
                                            <div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>Current Price</div>
                                                <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#333' }}>
                                                    â‚¹{stock.price}
                                                </div>
                                            </div>
                                            <div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>Strike Price</div>
                                                <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#333' }}>
                                                    â‚¹{stock.options.strikes.recommended}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style={{ 
                                            background: '#f8f9fa',
                                            padding: '12px',
                                            borderRadius: '8px',
                                            marginBottom: '10px'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Entry (Premium):</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#c62828' }}>
                                                    â‚¹{stock.options.strikes.recommended === stock.options.strikes.otm 
                                                        ? stock.options.premiums.put_otm
                                                        : stock.options.strikes.recommended === stock.options.strikes.atm
                                                        ? stock.options.premiums.put_atm
                                                        : stock.options.premiums.put_itm}
                                                </span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Target:</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#4CAF50' }}>
                                                    â‚¹{(() => {
                                                        const currentPrice = parseFloat(stock.price);
                                                        const targetPrice = parseFloat(stock.targetPrice);
                                                        const strikePrice = stock.options.strikes.recommended;
                                                        const premium = parseFloat(stock.options.strikes.recommended === stock.options.strikes.otm 
                                                            ? stock.options.premiums.put_otm
                                                            : stock.options.strikes.recommended === stock.options.strikes.atm
                                                            ? stock.options.premiums.put_atm
                                                            : stock.options.premiums.put_itm);
                                                        
                                                        // For PUT: intrinsic = max(0, strikePrice - targetPrice)
                                                        const intrinsicValue = Math.max(0, strikePrice - targetPrice);
                                                        const timeValue = intrinsicValue * 0.4;
                                                        const targetPremium = Math.max(intrinsicValue + timeValue, premium * 1.2);
                                                        return targetPremium.toFixed(2);
                                                    })()}
                                                </span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Expected By:</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#1976d2' }}>
                                                    ðŸ“… {stock.options.targetDate}
                                                </span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Stop Loss (50%):</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#d32f2f' }}>
                                                    â‚¹{(parseFloat(stock.options.strikes.recommended === stock.options.strikes.otm 
                                                        ? stock.options.premiums.put_otm
                                                        : stock.options.strikes.recommended === stock.options.strikes.atm
                                                        ? stock.options.premiums.put_atm
                                                        : stock.options.premiums.put_itm) * 0.5).toFixed(2)}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '8px' }}>
                                            ðŸ“… Expiry: {stock.options.expiry.recommended} | VIX: {stock.options.vix}
                                        </div>
                                        
                                        <div style={{ fontSize: '13px', color: '#c62828', fontWeight: '600' }}>
                                            ðŸ’¡ {stock.options.strategy}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'stockList') {
                if (isLoadingStocks) {
                    return (
                        <div>
                            <div className="header">
                                <h1>{selectedSector}</h1>
                                <p>Loading real-time data...</p>
                            </div>
                            <div style={{ 
                                padding: '50px 20px',
                                textAlign: 'center',
                                fontSize: '16px',
                                color: '#666'
                            }}>
                                ðŸ“Š Fetching live NSE prices...
                            </div>
                        </div>
                    );
                }

                return (
                    <div>
                        <div className="header">
                            <h1>{selectedSector}</h1>
                            <p>{stocks.length} stocks ranked by score</p>
                            <div style={{
                                background: 'rgba(255,255,255,0.1)',
                                padding: '10px 20px',
                                borderRadius: '8px',
                                marginTop: '10px',
                                fontSize: '13px',
                                color: '#fff'
                            }}>
                                âœ… Real NSE prices from Jan 2, 2026 (Friday close) â€¢ Updated daily at 9 AM IST
                            </div>
                        </div>
                        <button className="back-button" onClick={handleBack}>
                            â† Back to Sectors
                        </button>
                        {apiError && (
                            <div style={{
                                background: '#ffebee',
                                color: '#c62828',
                                padding: '15px',
                                margin: '20px',
                                borderRadius: '8px',
                                textAlign: 'center'
                            }}>
                                âš ï¸ {apiError}
                            </div>
                        )}
                        <div className="stock-list">
                            {stocks.map(stock => (
                                <div 
                                    key={stock.symbol}
                                    className="stock-item"
                                    onClick={() => handleStockClick(stock)}
                                >
                                    <div className="stock-header">
                                        <span className="stock-symbol">{stock.symbol || ''}</span>
                                        <span className={`stock-score ${
                                            (stock.score || 0) >= 70 ? 'score-high' : 
                                            (stock.score || 0) >= 40 ? 'score-medium' : 'score-low'
                                        }`}>
                                            {stock.score || 0}
                                        </span>
                                    </div>
                                    <div className="stock-name">{stock.name || stock.symbol}</div>
                                    <div className="stock-price">
                                        â‚¹{stock.price || '0'} 
                                        <span style={{ 
                                            color: parseFloat(stock.change || 0) >= 0 ? '#22c55e' : '#ef4444',
                                            marginLeft: '10px'
                                        }}>
                                            {parseFloat(stock.change || 0) >= 0 ? 'â†‘' : 'â†“'} â‚¹{Math.abs(parseFloat(stock.change || 0)).toFixed(2)} ({parseFloat(stock.changePercent || 0).toFixed(2)}%)
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            if (screen === 'stockDetail') {
                console.log(`ðŸ–¥ï¸ Rendering stockDetail screen for:`, selectedStock?.symbol);
                if (!selectedStock) {
                    return (
                        <div>
                            <div className="header">
                                <h1>Error</h1>
                                <p>No stock selected</p>
                            </div>
                            <button className="back-button" onClick={handleBack}>
                                â† Back
                            </button>
                        </div>
                    );
                }
                
                const opt = selectedStock.options || {};
                
                return (
                    <div key={`stockDetail-${selectedStock.symbol}`}>
                        <div className="header">
                            <h1>{selectedStock.symbol || 'Unknown'}</h1>
                            <p>{String(selectedStock.name || selectedStock.symbol || 'Unknown Stock')}</p>
                            <div style={{
                                background: 'rgba(255,255,255,0.1)',
                                padding: '8px 15px',
                                borderRadius: '6px',
                                marginTop: '8px',
                                fontSize: '12px',
                                color: '#fff'
                            }}>
                                â“˜ Data for informational purposes only â€¢ Not investment advice
                            </div>
                        </div>
                        <button className="back-button" onClick={handleBack}>
                            â† Back to {selectedSector}
                        </button>
                        
                        {/* Tabs - Dynamic based on category */}
                        <div className="tabs">
                            {/* Target Oriented tabs */}
                            {selectedSector === 'Target Oriented' && (
                                <>
                                    <div 
                                        className={`tab ${activeTab === 'overview' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('overview')}
                                    >
                                        Overview
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'targets' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('targets')}
                                    >
                                        Targets
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'levels' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('levels')}
                                    >
                                        Levels
                                    </div>
                                </>
                            )}
                            
                            {/* Swing Stocks tabs */}
                            {selectedSector === 'Swing Stocks' && (
                                <>
                                    <div 
                                        className={`tab ${activeTab === 'overview' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('overview')}
                                    >
                                        Overview
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'momentum' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('momentum')}
                                    >
                                        Momentum
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'entry-exit' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('entry-exit')}
                                    >
                                        Entry/Exit
                                    </div>
                                </>
                            )}
                            
                            {/* Fundamentally Strong tabs */}
                            {selectedSector === 'Fundamentally Strong' && (
                                <>
                                    <div 
                                        className={`tab ${activeTab === 'overview' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('overview')}
                                    >
                                        Overview
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'fundamentals' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('fundamentals')}
                                    >
                                        Fundamentals
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'valuation' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('valuation')}
                                    >
                                        Valuation
                                    </div>
                                </>
                            )}
                            
                            {/* Technically Strong tabs */}
                            {selectedSector === 'Technically Strong' && (
                                <>
                                    <div 
                                        className={`tab ${activeTab === 'overview' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('overview')}
                                    >
                                        Overview
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'technical' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('technical')}
                                    >
                                        Technical
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'patterns' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('patterns')}
                                    >
                                        Patterns
                                    </div>
                                </>
                            )}
                            
                            {/* Hot Stocks Today tabs */}
                            {selectedSector === 'Hot Stocks Today' && (
                                <>
                                    <div 
                                        className={`tab ${activeTab === 'overview' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('overview')}
                                    >
                                        Overview
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'intraday' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('intraday')}
                                    >
                                        Intraday
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'volume' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('volume')}
                                    >
                                        Volume
                                    </div>
                                </>
                            )}
                            
                            {/* Default tabs for sector-wise and others */}
                            {!['Target Oriented', 'Swing Stocks', 'Fundamentally Strong', 'Technically Strong', 'Hot Stocks Today'].includes(selectedSector) && (
                                <>
                                    <div 
                                        className={`tab ${activeTab === 'overview' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('overview')}
                                    >
                                        Overview
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'fundamentals' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('fundamentals')}
                                    >
                                        Fundamentals
                                    </div>
                                    <div 
                                        className={`tab ${activeTab === 'technical' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('technical')}
                                    >
                                        Technical
                                    </div>
                                </>
                            )}
                        </div>
                        
                        <div className="stock-detail">
                            <div className={`recommendation ${(selectedStock.recommendation || 'HOLD').toLowerCase()}`}>
                                {selectedStock.recommendation || 'HOLD'}
                            </div>
                            <div style={{ 
                                textAlign: 'center', 
                                marginTop: '10px', 
                                padding: '8px', 
                                background: '#f8f9fa', 
                                borderRadius: '8px',
                                marginBottom: '15px'
                            }}>
                                <div style={{ fontSize: '13px', color: '#666', marginBottom: '3px' }}>Target Price</div>
                                <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#2e7d32' }}>â‚¹{selectedStock.targetPrice}</div>
                                <div style={{ fontSize: '12px', color: '#888', marginTop: '3px' }}>
                                    {(() => {
                                        const current = parseFloat(selectedStock.price);
                                        const target = parseFloat(selectedStock.targetPrice);
                                        const percentChange = ((target - current) / current * 100).toFixed(1);
                                        const sign = percentChange >= 0 ? '+' : '';
                                        return `(${sign}${percentChange}% ${percentChange >= 0 ? 'upside' : 'downside'})`;
                                    })()}
                                </div>
                            </div>
                            
                            {/* Overview Tab */}
                            {activeTab === 'overview' && (
                                <div className="detail-card">
                                    <h3 style={{ marginBottom: '15px', color: '#333' }}>Overview</h3>
                                    <div className="metric-row">
                                        <span className="metric-label">Current Price</span>
                                        <span className="metric-value">â‚¹{selectedStock.price}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Overall Score</span>
                                        <span className="metric-value">{selectedStock.score}/100</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Market Cap</span>
                                        <span className="metric-value">{selectedStock.marketCap}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Volume</span>
                                        <span className="metric-value">{selectedStock.volume}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Day High</span>
                                        <span className="metric-value">â‚¹{selectedStock.dayHigh}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Day Low</span>
                                        <span className="metric-value">â‚¹{selectedStock.dayLow}</span>
                                    </div>
                                </div>
                            )}
                            
                            {/* Fundamentals Tab */}
                            {activeTab === 'fundamentals' && (
                                <div className="detail-card">
                                    <h3 style={{ marginBottom: '15px', color: '#333' }}>Fundamentals</h3>
                                    <div className="metric-row">
                                        <span className="metric-label">P/E Ratio</span>
                                        <span className="metric-value">{selectedStock.peRatio}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Book Value</span>
                                        <span className="metric-value">â‚¹{selectedStock.bookValue}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">Dividend Yield</span>
                                        <span className="metric-value">{selectedStock.dividendYield}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">52W High</span>
                                        <span className="metric-value">â‚¹{selectedStock.week52High}</span>
                                    </div>
                                    <div className="metric-row">
                                        <span className="metric-label">52W Low</span>
                                        <span className="metric-value">â‚¹{selectedStock.week52Low}</span>
                                    </div>
                                </div>
                            )}

                            {/* Technical Tab */}
                            {activeTab === 'technical' && (
                                <div>
                                    {/* Data Source Indicator */}
                                    {selectedStock.technical?.isRealData && (
                                        <div style={{
                                            background: '#dcfce7',
                                            color: '#166534',
                                            padding: '10px',
                                            borderRadius: '8px',
                                            marginBottom: '15px',
                                            fontSize: '13px',
                                            textAlign: 'center',
                                            border: '1px solid #22c55e'
                                        }}>
                                            âœ… <strong>Live Data:</strong> Technical indicators from Finnhub API
                                        </div>
                                    )}
                                    
                                    {/* Technical Score Card */}
                                    <div className="detail-card" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', marginBottom: '15px' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#fff' }}>ðŸ“Š Technical Score</h3>
                                        <div style={{ fontSize: '36px', fontWeight: 'bold', textAlign: 'center', margin: '10px 0' }}>
                                            {selectedStock.technical?.score || 'N/A'}/100
                                        </div>
                                        <div style={{ textAlign: 'center', fontSize: '14px', opacity: 0.9 }}>
                                            Based on RSI, MACD, Moving Averages & Volume
                                        </div>
                                    </div>

                                    {/* Chart Pattern Button */}
                                    {selectedStock.technical?.pattern && (
                                        <button 
                                            onClick={() => setShowPatternModal(true)}
                                            style={{
                                                width: '100%',
                                                background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                                                color: 'white',
                                                border: 'none',
                                                padding: '15px',
                                                borderRadius: '10px',
                                                fontSize: '16px',
                                                fontWeight: 'bold',
                                                cursor: 'pointer',
                                                marginBottom: '15px',
                                                boxShadow: '0 4px 15px rgba(245, 87, 108, 0.4)',
                                                transition: 'transform 0.2s'
                                            }}
                                            onMouseOver={(e) => e.target.style.transform = 'scale(1.02)'}
                                            onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                                        >
                                            ðŸ“Š View Chart Pattern Analysis
                                        </button>
                                    )}

                                    {/* Moving Averages */}
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“ˆ Moving Averages</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">EMA (50)</span>
                                            <span className="metric-value">â‚¹{selectedStock.technical?.ma?.ema50 || selectedStock.ema50}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">EMA (200)</span>
                                            <span className="metric-value">â‚¹{selectedStock.technical?.ma?.ema200 || selectedStock.ema200}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Crossover Signal</span>
                                            <span className="metric-value" style={{ 
                                                color: selectedStock.technical?.ma?.trend === 'BULLISH' ? '#22c55e' : '#ef4444',
                                                fontWeight: 'bold'
                                            }}>
                                                {selectedStock.technical?.ma?.crossover || 'N/A'}
                                            </span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Trend Strength</span>
                                            <span className="metric-value">{selectedStock.technical?.ma?.strength || 'N/A'}%</span>
                                        </div>
                                    </div>

                                    {/* MACD Analysis */}
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“‰ MACD Analysis</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">MACD Value</span>
                                            <span className="metric-value">{selectedStock.technical?.macd?.value || selectedStock.macd}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Signal Line</span>
                                            <span className="metric-value">{selectedStock.technical?.macd?.signal || 'N/A'}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Histogram</span>
                                            <span className="metric-value" style={{ 
                                                color: parseFloat(selectedStock.technical?.macd?.histogram || 0) > 0 ? '#22c55e' : '#ef4444'
                                            }}>
                                                {selectedStock.technical?.macd?.histogram || 'N/A'}
                                            </span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Signal Type</span>
                                            <span className="metric-value" style={{ 
                                                color: selectedStock.technical?.macd?.trend === 'BULLISH' ? '#22c55e' : '#ef4444',
                                                fontWeight: 'bold'
                                            }}>
                                                {selectedStock.technical?.macd?.signalType || 'N/A'}
                                            </span>
                                        </div>
                                    </div>

                                    {/* RSI Analysis */}
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ’¹ RSI Analysis</h3>
                                        <div style={{ textAlign: 'center', marginBottom: '15px' }}>
                                            <div style={{ fontSize: '32px', fontWeight: 'bold', color: '#667eea' }}>
                                                {selectedStock.technical?.rsi?.value || selectedStock.rsi}
                                            </div>
                                            <div style={{ 
                                                fontSize: '14px',
                                                padding: '5px 10px',
                                                borderRadius: '15px',
                                                display: 'inline-block',
                                                marginTop: '5px',
                                                background: selectedStock.technical?.rsi?.zone === 'Oversold' ? '#dcfce7' : 
                                                           selectedStock.technical?.rsi?.zone === 'Overbought' ? '#fee2e2' : '#f3f4f6',
                                                color: selectedStock.technical?.rsi?.zone === 'Oversold' ? '#166534' : 
                                                       selectedStock.technical?.rsi?.zone === 'Overbought' ? '#991b1b' : '#374151'
                                            }}>
                                                {selectedStock.technical?.rsi?.zone || 'N/A'}
                                            </div>
                                        </div>
                                        <div style={{ fontSize: '13px', color: '#666', textAlign: 'center', padding: '10px', background: '#f8f9fa', borderRadius: '8px' }}>
                                            {selectedStock.technical?.rsi?.signal || 'Normal Range'}
                                        </div>
                                    </div>

                                    {/* Support & Resistance */}
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸŽ¯ Support & Resistance Levels</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">Resistance 2</span>
                                            <span className="metric-value" style={{ color: '#ef4444' }}>â‚¹{selectedStock.technical?.levels?.resistance2 || 'N/A'}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Resistance 1</span>
                                            <span className="metric-value" style={{ color: '#f97316' }}>â‚¹{selectedStock.technical?.levels?.resistance1 || 'N/A'}</span>
                                        </div>
                                        <div className="metric-row" style={{ background: '#e0f2fe', padding: '10px', borderRadius: '5px' }}>
                                            <span className="metric-label" style={{ fontWeight: 'bold' }}>Current Price</span>
                                            <span className="metric-value" style={{ fontWeight: 'bold', color: '#0369a1' }}>â‚¹{selectedStock.price}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Support 1</span>
                                            <span className="metric-value" style={{ color: '#22c55e' }}>â‚¹{selectedStock.technical?.levels?.support1 || 'N/A'}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Support 2</span>
                                            <span className="metric-value" style={{ color: '#16a34a' }}>â‚¹{selectedStock.technical?.levels?.support2 || 'N/A'}</span>
                                        </div>
                                    </div>

                                    {/* Volume Analysis */}
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“Š Volume Analysis</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">Current Volume</span>
                                            <span className="metric-value">{selectedStock.technical?.volume?.current || selectedStock.volume}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Average Volume</span>
                                            <span className="metric-value">{selectedStock.technical?.volume?.average || 'N/A'}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Volume Trend</span>
                                            <span className="metric-value">{selectedStock.technical?.volume?.trend || 'N/A'}</span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* TARGET ORIENTED - Targets Tab */}
                            {activeTab === 'targets' && selectedSector === 'Target Oriented' && (
                                <div>
                                    <div className="detail-card" style={{ background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)', color: 'white', marginBottom: '15px' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#fff' }}>ðŸŽ¯ Target Analysis</h3>
                                        <div style={{ fontSize: '32px', fontWeight: 'bold', textAlign: 'center', margin: '10px 0' }}>
                                            â‚¹{selectedStock.targetPrice}
                                        </div>
                                        <div style={{ textAlign: 'center', fontSize: '14px', opacity: 0.9 }}>
                                            {(() => {
                                                const percentChange = ((parseFloat(selectedStock.targetPrice) - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(1);
                                                return `${percentChange > 0 ? '+' : ''}${percentChange}% upside potential`;
                                            })()}
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“Š Price Targets</h3>
                                        <div style={{ background: '#dcfce7', padding: '12px', borderRadius: '8px', marginBottom: '10px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Conservative Target</span>
                                                <span style={{ fontSize: '15px', fontWeight: 'bold', color: '#16a34a' }}>â‚¹{(parseFloat(selectedStock.price) * 1.05).toFixed(2)}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#888' }}>+5% | Low Risk | 7-10 days</div>
                                        </div>
                                        
                                        <div style={{ background: '#fef3c7', padding: '12px', borderRadius: '8px', marginBottom: '10px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Primary Target</span>
                                                <span style={{ fontSize: '15px', fontWeight: 'bold', color: '#ca8a04' }}>â‚¹{selectedStock.targetPrice}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#888' }}>
                                                {(() => {
                                                    const percentChange = ((parseFloat(selectedStock.targetPrice) - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(0);
                                                    return `${percentChange > 0 ? '+' : ''}${percentChange}% | Medium Risk | 15-20 days`;
                                                })()}
                                            </div>
                                        </div>
                                        
                                        <div style={{ background: '#dbeafe', padding: '12px', borderRadius: '8px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Stretch Target</span>
                                                <span style={{ fontSize: '15px', fontWeight: 'bold', color: '#0369a1' }}>â‚¹{(parseFloat(selectedStock.targetPrice) * 1.08).toFixed(2)}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#888' }}>
                                                {(() => {
                                                    const percentChange = ((parseFloat(selectedStock.targetPrice) * 1.08 - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(0);
                                                    return `${percentChange > 0 ? '+' : ''}${percentChange}% | High Risk | 25-30 days`;
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card" style={{ background: '#fee2e2', border: '1px solid #ef4444' }}>
                                        <h3 style={{ marginBottom: '15px', color: '#dc2626' }}>ðŸ›¡ï¸ Risk Management</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">Stop Loss</span>
                                            <span className="metric-value" style={{ color: '#dc2626' }}>â‚¹{selectedStock.stopLoss}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Max Loss</span>
                                            <span className="metric-value" style={{ color: '#dc2626' }}>
                                                {((parseFloat(selectedStock.price) - parseFloat(selectedStock.stopLoss)) / parseFloat(selectedStock.price) * 100).toFixed(1)}%
                                            </span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Risk/Reward</span>
                                            <span className="metric-value">
                                                1:{(((parseFloat(selectedStock.targetPrice) - parseFloat(selectedStock.price)) / (parseFloat(selectedStock.price) - parseFloat(selectedStock.stopLoss)))).toFixed(1)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* TARGET ORIENTED - Levels Tab */}
                            {activeTab === 'levels' && selectedSector === 'Target Oriented' && (
                                <div className="detail-card">
                                    <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“ Key Price Levels</h3>
                                    
                                    <div style={{ marginBottom: '20px' }}>
                                        <h4 style={{ fontSize: '14px', color: '#ef4444', marginBottom: '10px' }}>ðŸ”´ Resistance Levels</h4>
                                        <div style={{ background: '#fee2e2', padding: '10px', borderRadius: '8px', marginBottom: '8px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span>Strong Resistance (R2)</span>
                                                <span style={{ fontWeight: 'bold' }}>â‚¹{selectedStock.technical?.levels?.resistance2}</span>
                                            </div>
                                        </div>
                                        <div style={{ background: '#fecaca', padding: '10px', borderRadius: '8px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span>Resistance (R1)</span>
                                                <span style={{ fontWeight: 'bold' }}>â‚¹{selectedStock.technical?.levels?.resistance1}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style={{ background: '#dbeafe', padding: '15px', borderRadius: '10px', margin: '15px 0', textAlign: 'center', border: '2px solid #0369a1' }}>
                                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Current Price</div>
                                        <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#0369a1' }}>â‚¹{selectedStock.price}</div>
                                    </div>
                                    
                                    <div style={{ marginTop: '20px' }}>
                                        <h4 style={{ fontSize: '14px', color: '#22c55e', marginBottom: '10px' }}>ðŸŸ¢ Support Levels</h4>
                                        <div style={{ background: '#bbf7d0', padding: '10px', borderRadius: '8px', marginBottom: '8px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span>Support (S1)</span>
                                                <span style={{ fontWeight: 'bold' }}>â‚¹{selectedStock.technical?.levels?.support1}</span>
                                            </div>
                                        </div>
                                        <div style={{ background: '#dcfce7', padding: '10px', borderRadius: '8px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span>Strong Support (S2)</span>
                                                <span style={{ fontWeight: 'bold' }}>â‚¹{selectedStock.technical?.levels?.support2}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style={{ marginTop: '15px', padding: '12px', background: '#f3f4f6', borderRadius: '8px', fontSize: '12px', color: '#666' }}>
                                        <strong>ðŸ’¡ Trading Strategy:</strong><br/>
                                        â€¢ Buy near support levels (S1, S2)<br/>
                                        â€¢ Book profits near resistance levels (R1, R2)<br/>
                                        â€¢ Break above R2 = Strong bullish signal<br/>
                                        â€¢ Break below S2 = Consider stop loss
                                    </div>
                                </div>
                            )}
                            
                            {/* SWING STOCKS - Momentum Tab */}
                            {activeTab === 'momentum' && selectedSector === 'Swing Stocks' && (
                                <div>
                                    <div className="detail-card" style={{ background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)', color: 'white', marginBottom: '15px' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#fff' }}>âš¡ Momentum Score</h3>
                                        <div style={{ fontSize: '36px', fontWeight: 'bold', textAlign: 'center', margin: '10px 0' }}>
                                            {selectedStock.momentumScore || Math.floor(Math.abs(parseFloat(selectedStock.changePercent)) * 20 + 50)}/100
                                        </div>
                                        <div style={{ textAlign: 'center', fontSize: '14px', opacity: 0.9 }}>
                                            Based on price action & volume
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“ˆ Momentum Indicators</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">Today's Change</span>
                                            <span className="metric-value" style={{ color: parseFloat(selectedStock.changePercent) > 0 ? '#22c55e' : '#ef4444', fontWeight: 'bold' }}>
                                                {parseFloat(selectedStock.changePercent) > 0 ? '+' : ''}{selectedStock.changePercent}%
                                            </span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Volume Trend</span>
                                            <span className="metric-value">{selectedStock.technical?.volume?.trend || 'Normal Volume'}</span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">RSI (14)</span>
                                            <span className="metric-value" style={{ 
                                                color: parseFloat(selectedStock.rsi) < 30 ? '#22c55e' : parseFloat(selectedStock.rsi) > 70 ? '#ef4444' : '#f59e0b'
                                            }}>
                                                {selectedStock.rsi}
                                            </span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">MACD Signal</span>
                                            <span className="metric-value" style={{ 
                                                color: selectedStock.technical?.macd?.trend === 'BULLISH' ? '#22c55e' : '#ef4444'
                                            }}>
                                                {selectedStock.technical?.macd?.signalType || 'Neutral'}
                                            </span>
                                        </div>
                                        <div className="metric-row">
                                            <span className="metric-label">Trend</span>
                                            <span className="metric-value" style={{ 
                                                color: selectedStock.technical?.ma?.trend === 'BULLISH' ? '#22c55e' : '#ef4444',
                                                fontWeight: 'bold'
                                            }}>
                                                {selectedStock.technical?.ma?.trend || 'NEUTRAL'}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card" style={{ background: '#fef3c7' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#92400e' }}>â±ï¸ Swing Trade Setup</h3>
                                        <div style={{ fontSize: '13px', color: '#78350f', lineHeight: '1.6' }}>
                                            <strong>Duration:</strong> 3-7 days<br/>
                                            <strong>Entry Zone:</strong> â‚¹{(parseFloat(selectedStock.price) * 0.98).toFixed(2)} - â‚¹{selectedStock.price}<br/>
                                            <strong>Target:</strong> â‚¹{selectedStock.targetPrice}<br/>
                                            <strong>Stop Loss:</strong> â‚¹{selectedStock.stopLoss}<br/>
                                            <strong>Position Size:</strong> Risk 1-2% of capital
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* SWING STOCKS - Entry/Exit Tab */}
                            {activeTab === 'entry-exit' && selectedSector === 'Swing Stocks' && (
                                <div className="detail-card">
                                    <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸŽ¯ Entry & Exit Strategy</h3>
                                    
                                    <div style={{ background: '#dcfce7', padding: '15px', borderRadius: '10px', marginBottom: '15px' }}>
                                        <h4 style={{ fontSize: '14px', color: '#166534', marginBottom: '10px' }}>âœ… Entry Points</h4>
                                        <div style={{ marginBottom: '10px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px' }}>Aggressive Entry</span>
                                                <span style={{ fontWeight: 'bold', color: '#16a34a' }}>â‚¹{selectedStock.price}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#666' }}>Buy at current price (higher risk)</div>
                                        </div>
                                        <div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px' }}>Conservative Entry</span>
                                                <span style={{ fontWeight: 'bold', color: '#16a34a' }}>â‚¹{(parseFloat(selectedStock.price) * 0.98).toFixed(2)}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#666' }}>Wait for 2% dip (lower risk)</div>
                                        </div>
                                    </div>
                                    
                                    <div style={{ background: '#fef3c7', padding: '15px', borderRadius: '10px', marginBottom: '15px' }}>
                                        <h4 style={{ fontSize: '14px', color: '#92400e', marginBottom: '10px' }}>ðŸŽ Exit Points</h4>
                                        <div style={{ marginBottom: '10px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px' }}>Partial Exit (50%)</span>
                                                <span style={{ fontWeight: 'bold', color: '#ca8a04' }}>â‚¹{(parseFloat(selectedStock.price) * 1.05).toFixed(2)}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#666' }}>Book 50% profit at +5%</div>
                                        </div>
                                        <div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
                                                <span style={{ fontSize: '13px' }}>Full Exit (100%)</span>
                                                <span style={{ fontWeight: 'bold', color: '#ca8a04' }}>â‚¹{selectedStock.targetPrice}</span>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#666' }}>Exit remaining at target</div>
                                        </div>
                                    </div>
                                    
                                    <div style={{ background: '#fee2e2', padding: '15px', borderRadius: '10px' }}>
                                        <h4 style={{ fontSize: '14px', color: '#dc2626', marginBottom: '10px' }}>ðŸ›‘ Stop Loss</h4>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px' }}>
                                            <span style={{ fontSize: '13px' }}>Initial Stop Loss</span>
                                            <span style={{ fontWeight: 'bold', color: '#dc2626' }}>â‚¹{selectedStock.stopLoss}</span>
                                        </div>
                                        <div style={{ fontSize: '11px', color: '#991b1b', background: '#fecaca', padding: '8px', borderRadius: '6px' }}>
                                            <strong>âš ï¸ Important:</strong> Move stop loss to cost once price reaches +3% to protect capital
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* FUNDAMENTALLY STRONG - Valuation Tab */}
                            {activeTab === 'valuation' && selectedSector === 'Fundamentally Strong' && (
                                <div>
                                    <div className="detail-card" style={{ background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)', color: 'white', marginBottom: '15px' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#fff' }}>ðŸ’Ž Valuation Score</h3>
                                        <div style={{ fontSize: '36px', fontWeight: 'bold', textAlign: 'center', margin: '10px 0' }}>
                                            {selectedStock.fundamentalScore || (parseFloat(selectedStock.peRatio) < 20 ? 85 : parseFloat(selectedStock.peRatio) < 30 ? 70 : 55)}/100
                                        </div>
                                        <div style={{ textAlign: 'center', fontSize: '14px', opacity: 0.9 }}>
                                            Based on P/E, Book Value & Dividends
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“Š Valuation Metrics</h3>
                                        <div className="metric-row">
                                            <span className="metric-label">P/E Ratio</span>
                                            <span className="metric-value" style={{ 
                                                color: parseFloat(selectedStock.peRatio) < 20 ? '#22c55e' : parseFloat(selectedStock.peRatio) < 30 ? '#f59e0b' : '#ef4444'
                                            }}>
                                                {selectedStock.peRatio}
                                            </span>
                                        </div>
                                        <div style={{ fontSize: '11px', color: '#666', marginLeft: '10px', marginTop: '-8px', marginBottom: '8px' }}>
                                            {parseFloat(selectedStock.peRatio) < 20 ? 'âœ… Undervalued' : parseFloat(selectedStock.peRatio) < 30 ? 'âš ï¸ Fairly valued' : 'âŒ Overvalued'}
                                        </div>
                                        
                                        <div className="metric-row">
                                            <span className="metric-label">Price to Book</span>
                                            <span className="metric-value">
                                                {(parseFloat(selectedStock.price) / parseFloat(selectedStock.bookValue)).toFixed(2)}
                                            </span>
                                        </div>
                                        <div style={{ fontSize: '11px', color: '#666', marginLeft: '10px', marginTop: '-8px', marginBottom: '8px' }}>
                                            {(parseFloat(selectedStock.price) / parseFloat(selectedStock.bookValue)) < 3 ? 'âœ… Good value' : 'âš ï¸ Check fundamentals'}
                                        </div>
                                        
                                        <div className="metric-row">
                                            <span className="metric-label">Dividend Yield</span>
                                            <span className="metric-value">{selectedStock.dividendYield}</span>
                                        </div>
                                        
                                        <div className="metric-row">
                                            <span className="metric-label">Book Value</span>
                                            <span className="metric-value">â‚¹{selectedStock.bookValue}</span>
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card" style={{ background: '#e0f2fe' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#0369a1' }}>ðŸ“… Investment Horizon</h3>
                                        <div style={{ fontSize: '13px', color: '#075985', lineHeight: '1.6' }}>
                                            <strong>Recommended Duration:</strong> 6-12 months<br/>
                                            <strong>Investment Style:</strong> Long-term value investing<br/>
                                            <strong>Risk Level:</strong> Low to Medium<br/>
                                            <strong>Expected Return:</strong> {((parseFloat(selectedStock.targetPrice) - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(0)}% - {((parseFloat(selectedStock.targetPrice) * 1.2 - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(0)}%<br/>
                                            <strong>Ideal For:</strong> Long-term wealth creation
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* TECHNICALLY STRONG - Patterns Tab */}
                            {activeTab === 'patterns' && selectedSector === 'Technically Strong' && (
                                <div>
                                    {selectedStock.technical?.pattern && (
                                        <>
                                            <div className="detail-card" style={{ 
                                                background: selectedStock.technical.pattern.type === 'BULLISH' ? 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)' : 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)',
                                                border: `2px solid ${selectedStock.technical.pattern.type === 'BULLISH' ? '#22c55e' : '#ef4444'}`
                                            }}>
                                                <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“Š Detected Pattern</h3>
                                                <div style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '10px', color: '#333' }}>
                                                    {selectedStock.technical.pattern.name}
                                                </div>
                                                <div style={{ 
                                                    fontSize: '16px', 
                                                    fontWeight: 'bold',
                                                    color: selectedStock.technical.pattern.type === 'BULLISH' ? '#16a34a' : '#dc2626',
                                                    marginBottom: '10px'
                                                }}>
                                                    {selectedStock.technical.pattern.type === 'BULLISH' ? 'ðŸŸ¢ BULLISH PATTERN' : 'ðŸ”´ BEARISH PATTERN'}
                                                </div>
                                                <div style={{ fontSize: '13px', color: '#666' }}>
                                                    Reliability: <strong>{selectedStock.technical.pattern.reliability}%</strong>
                                                </div>
                                            </div>
                                            
                                            <div className="detail-card">
                                                <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸŽ¯ Pattern Details</h3>
                                                <div className="metric-row">
                                                    <span className="metric-label">Current Price</span>
                                                    <span className="metric-value">â‚¹{selectedStock.price}</span>
                                                </div>
                                                <div className="metric-row">
                                                    <span className="metric-label">Pattern Target</span>
                                                    <span className="metric-value" style={{ 
                                                        color: selectedStock.technical.pattern.type === 'BULLISH' ? '#22c55e' : '#ef4444',
                                                        fontWeight: 'bold'
                                                    }}>
                                                        â‚¹{selectedStock.technical.pattern.target}
                                                    </span>
                                                </div>
                                                <div className="metric-row">
                                                    <span className="metric-label">Expected Time</span>
                                                    <span className="metric-value">{selectedStock.technical.pattern.timeframe}</span>
                                                </div>
                                                <div className="metric-row">
                                                    <span className="metric-label">Potential Move</span>
                                                    <span className="metric-value" style={{ 
                                                        color: selectedStock.technical.pattern.type === 'BULLISH' ? '#22c55e' : '#ef4444',
                                                        fontWeight: 'bold'
                                                    }}>
                                                        {((parseFloat(selectedStock.technical.pattern.target) - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(1)}%
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <button 
                                                onClick={() => setShowPatternModal(true)}
                                                style={{
                                                    width: '100%',
                                                    background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '15px',
                                                    borderRadius: '10px',
                                                    fontSize: '16px',
                                                    fontWeight: 'bold',
                                                    cursor: 'pointer',
                                                    boxShadow: '0 4px 15px rgba(245, 87, 108, 0.4)'
                                                }}
                                            >
                                                ðŸ“Š View Chart Pattern Visualization
                                            </button>
                                        </>
                                    )}
                                </div>
                            )}
                            
                            {/* HOT STOCKS TODAY - Intraday Tab */}
                            {activeTab === 'intraday' && selectedSector === 'Hot Stocks Today' && (
                                <div>
                                    <div className="detail-card" style={{ background: 'linear-gradient(135deg, #f59e0b 0%, #ea580c 100%)', color: 'white', marginBottom: '15px' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#fff' }}>ðŸ”¥ Intraday Performance</h3>
                                        <div style={{ fontSize: '32px', fontWeight: 'bold', textAlign: 'center', margin: '10px 0' }}>
                                            {parseFloat(selectedStock.changePercent) > 0 ? '+' : ''}{selectedStock.changePercent}%
                                        </div>
                                        <div style={{ textAlign: 'center', fontSize: '14px', opacity: 0.9 }}>
                                            Today's price movement
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card">
                                        <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“Š Today's Range</h3>
                                        <div style={{ marginBottom: '15px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Day High</span>
                                                <span style={{ fontSize: '16px', fontWeight: 'bold', color: '#22c55e' }}>â‚¹{selectedStock.dayHigh}</span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Current</span>
                                                <span style={{ fontSize: '16px', fontWeight: 'bold', color: '#0369a1' }}>â‚¹{selectedStock.price}</span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                <span style={{ fontSize: '13px', color: '#666' }}>Day Low</span>
                                                <span style={{ fontSize: '16px', fontWeight: 'bold', color: '#ef4444' }}>â‚¹{selectedStock.dayLow}</span>
                                            </div>
                                        </div>
                                        
                                        <div style={{ background: '#f3f4f6', padding: '12px', borderRadius: '8px' }}>
                                            <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Day's Range</div>
                                            <div style={{ height: '8px', background: '#e5e7eb', borderRadius: '4px', position: 'relative', overflow: 'hidden' }}>
                                                <div style={{ 
                                                    position: 'absolute',
                                                    left: 0,
                                                    width: `${((parseFloat(selectedStock.price) - parseFloat(selectedStock.dayLow)) / (parseFloat(selectedStock.dayHigh) - parseFloat(selectedStock.dayLow)) * 100)}%`,
                                                    height: '100%',
                                                    background: 'linear-gradient(90deg, #ef4444 0%, #22c55e 100%)',
                                                    borderRadius: '4px'
                                                }}></div>
                                            </div>
                                            <div style={{ fontSize: '11px', color: '#888', marginTop: '5px' }}>
                                                Price at {((parseFloat(selectedStock.price) - parseFloat(selectedStock.dayLow)) / (parseFloat(selectedStock.dayHigh) - parseFloat(selectedStock.dayLow)) * 100).toFixed(0)}% of day's range
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="detail-card" style={{ background: '#fef3c7' }}>
                                        <h3 style={{ marginBottom: '10px', color: '#92400e' }}>âš¡ Intraday Trading Levels</h3>
                                        <div style={{ fontSize: '13px', color: '#78350f', lineHeight: '1.6' }}>
                                            <strong>Buy Above:</strong> â‚¹{(parseFloat(selectedStock.price) * 1.005).toFixed(2)}<br/>
                                            <strong>Sell Below:</strong> â‚¹{(parseFloat(selectedStock.price) * 0.995).toFixed(2)}<br/>
                                            <strong>Intraday Target:</strong> â‚¹{(parseFloat(selectedStock.price) * 1.015).toFixed(2)}<br/>
                                            <strong>Intraday Stop Loss:</strong> â‚¹{(parseFloat(selectedStock.price) * 0.985).toFixed(2)}
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* HOT STOCKS TODAY - Volume Tab */}
                            {activeTab === 'volume' && selectedSector === 'Hot Stocks Today' && (
                                <div className="detail-card">
                                    <h3 style={{ marginBottom: '15px', color: '#333' }}>ðŸ“Š Volume Analysis</h3>
                                    
                                    <div style={{ background: '#dbeafe', padding: '15px', borderRadius: '10px', marginBottom: '15px' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px' }}>
                                            <span style={{ fontSize: '13px', color: '#666' }}>Today's Volume</span>
                                            <span style={{ fontSize: '18px', fontWeight: 'bold', color: '#0369a1' }}>
                                                {selectedStock.technical?.volume?.current || selectedStock.volume}
                                            </span>
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                            <span style={{ fontSize: '13px', color: '#666' }}>Average Volume</span>
                                            <span style={{ fontSize: '16px', fontWeight: 'bold', color: '#666' }}>
                                                {selectedStock.technical?.volume?.average || selectedStock.volume}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div style={{ background: '#f3f4f6', padding: '15px', borderRadius: '10px', marginBottom: '15px' }}>
                                        <div style={{ fontSize: '14px', fontWeight: 'bold', marginBottom: '10px', color: '#333' }}>
                                            Volume Status
                                        </div>
                                        <div style={{ 
                                            fontSize: '16px', 
                                            fontWeight: 'bold',
                                            color: selectedStock.technical?.volume?.trend?.includes('High') ? '#22c55e' : '#f59e0b',
                                            marginBottom: '5px'
                                        }}>
                                            {selectedStock.technical?.volume?.trend || 'Normal Volume'}
                                        </div>
                                        <div style={{ fontSize: '12px', color: '#666' }}>
                                            {selectedStock.technical?.volume?.trend?.includes('High') ? 
                                                'âœ… High volume indicates strong interest' : 
                                                'âš ï¸ Normal volume - monitor for breakout'}
                                        </div>
                                    </div>
                                    
                                    <div style={{ padding: '12px', background: '#fef3c7', borderRadius: '8px', fontSize: '12px', color: '#78350f' }}>
                                        <strong>ðŸ’¡ Volume Insight:</strong><br/>
                                        {parseFloat(selectedStock.changePercent) > 0 ? 
                                            'â€¢ Rising price with high volume = Strong bullish momentum' :
                                            'â€¢ Falling price with high volume = Strong bearish pressure'}<br/>
                                        â€¢ Watch for volume spikes for entry/exit signals<br/>
                                        â€¢ Low volume moves are less reliable
                                    </div>
                                </div>
                            )}

                            {/* Chart Pattern Modal */}
                            {showPatternModal && selectedStock.technical?.pattern && (
                                <div onClick={() => setShowPatternModal(false)} style={{
                                    position: 'fixed',
                                    top: 0,
                                    left: 0,
                                    right: 0,
                                    bottom: 0,
                                    background: 'rgba(0,0,0,0.7)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    zIndex: 1000,
                                    padding: '20px'
                                }}>
                                    <div onClick={(e) => e.stopPropagation()} style={{
                                        background: 'white',
                                        borderRadius: '15px',
                                        padding: '25px',
                                        maxWidth: '500px',
                                        width: '100%',
                                        maxHeight: '90vh',
                                        overflowY: 'auto',
                                        boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
                                    }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                            <h2 style={{ color: '#333', margin: 0 }}>ðŸ“Š Chart Pattern Analysis</h2>
                                            <button onClick={() => setShowPatternModal(false)} style={{
                                                background: 'none',
                                                border: 'none',
                                                fontSize: '24px',
                                                cursor: 'pointer',
                                                color: '#666'
                                            }}>Ã—</button>
                                        </div>

                                        {/* Pattern Name */}
                                        <div style={{
                                            background: selectedStock.technical.pattern.type === 'BULLISH' ? 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)' : 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)',
                                            padding: '20px',
                                            borderRadius: '10px',
                                            marginBottom: '20px',
                                            border: `2px solid ${selectedStock.technical.pattern.type === 'BULLISH' ? '#22c55e' : '#ef4444'}`
                                        }}>
                                            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333', marginBottom: '5px' }}>
                                                {selectedStock.technical.pattern.name}
                                            </div>
                                            <div style={{ 
                                                fontSize: '18px', 
                                                fontWeight: 'bold',
                                                color: selectedStock.technical.pattern.type === 'BULLISH' ? '#16a34a' : '#dc2626'
                                            }}>
                                                {selectedStock.technical.pattern.type === 'BULLISH' ? 'ðŸŸ¢ BULLISH PATTERN' : 'ðŸ”´ BEARISH PATTERN'}
                                            </div>
                                        </div>

                                        {/* ASCII Chart Representation */}
                                        <div style={{
                                            background: '#1e293b',
                                            padding: '15px',
                                            borderRadius: '10px',
                                            marginBottom: '20px',
                                            fontFamily: 'monospace',
                                            fontSize: '11px',
                                            color: '#10b981',
                                            overflowX: 'auto'
                                        }}>
                                            <pre style={{ margin: 0 }}>{(() => {
                                                const pattern = selectedStock.technical.pattern;
                                                const currentPriceNum = parseFloat(selectedStock.price);
                                                const targetPriceNum = parseFloat(pattern.target);
                                                
                                                if (pattern.name === 'Ascending Triangle') {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.08).toFixed(0)} â”¤â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  Resistance (Breakout Level)
     â”‚       â•±â”â•±
     â”‚     â•±â”â•±
â‚¹${currentPriceNum.toFixed(0)} â”¤â”â”â•±â”â•±           â¬… Current Price
     â”‚ â•±â”â•±  
     â”‚â•±                       
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Higher lows approaching resistance
Signal: BULLISH breakout expected at â‚¹${(currentPriceNum * 1.08).toFixed(0)}`;
                                                } else if (pattern.name === 'Head and Shoulders') {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.1).toFixed(0)} â”¤        â•±â•²           Head
     â”‚       â•±  â•²
â‚¹${currentPriceNum.toFixed(0)} â”¤  â•±â•²  â•±    â•²  â•±â•²  â¬… Current (Right Shoulder)
     â”‚ â•±  â•²â•±      â•²â•±  â•²
â‚¹${(currentPriceNum * 0.95).toFixed(0)} â”¤â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  Neckline (Support)
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Classic reversal pattern
Signal: BEARISH breakdown expected below â‚¹${(currentPriceNum * 0.95).toFixed(0)}`;
                                                } else if (pattern.name === 'Double Bottom') {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.08).toFixed(0)} â”¤              â•±
     â”‚            â•±
â‚¹${currentPriceNum.toFixed(0)} â”¤â”â”â”â”â”â”â”â”â”â”â”â”  â¬… Current Price (Neckline)
     â”‚  â•²      â•±
     â”‚   â•²    â•±
â‚¹${(currentPriceNum * 0.92).toFixed(0)} â”¤    â•²â•±â•²â•±
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Double bottom support holding
Signal: BULLISH reversal - Target â‚¹${pattern.target}`;
                                                } else if (pattern.name === 'Falling Wedge') {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.05).toFixed(0)} â”¤â•²
     â”‚ â•²â”â”â•²â”â”â•²           Converging trendlines
â‚¹${currentPriceNum.toFixed(0)} â”¤  â•²â”â”â•²â”â”â•²  â¬… Current Price
     â”‚   â•²â”â”â•²â”â”â•²
     â”‚    â•²â”â”â•²â”â”â•²
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Falling wedge (Bullish reversal)
Signal: Upside breakout expected - Target â‚¹${pattern.target}`;
                                                } else if (pattern.name === 'Rising Wedge') {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.05).toFixed(0)} â”¤    â•±â”â”â•±â”â”â•±
     â”‚   â•±â”â”â•±â”â”â•±         Converging trendlines
â‚¹${currentPriceNum.toFixed(0)} â”¤  â•±â”â”â•±â”â”â•±  â¬… Current Price
     â”‚ â•±â”â”â•±â”â”â•±
     â”‚â•±
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Rising wedge (Bearish reversal)
Signal: Downside breakdown expected - Target â‚¹${pattern.target}`;
                                                } else if (pattern.name === 'Cup and Handle') {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.15).toFixed(0)} â”¤â•²                    â•±â”â•²  Breakout Area
     â”‚ â•²                  â•±   â•² Handle
â‚¹${currentPriceNum.toFixed(0)} â”¤  â•²                â•±     â•²â•±  â¬… Current
     â”‚   â•²              â•±         
     â”‚    â•²    CUP    â•±
     â”‚     â•²        â•±
â‚¹${(currentPriceNum * 0.92).toFixed(0)} â”¤      â•²______â•±
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Cup and Handle (Very bullish)
Signal: Breakout above â‚¹${(currentPriceNum * 1.08).toFixed(0)} â†’ Target â‚¹${pattern.target}`;
                                                } else {
                                                    return `
Price
â‚¹${(currentPriceNum * 1.08).toFixed(0)} â”¤    â•±â•²      â•±â•²       Double Top
     â”‚   â•±  â•²    â•±  â•²
â‚¹${currentPriceNum.toFixed(0)} â”¤  â•±    â•²  â•±    â•²  â¬… Current Price
     â”‚ â•±      â•²â•±      â•²
â‚¹${(currentPriceNum * 0.95).toFixed(0)} â”¤â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  Support Breaking
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
     
Pattern: Double Top (Bearish reversal)
Signal: Breakdown expected - Target â‚¹${pattern.target}`;
                                                }
                                            })()}</pre>
                                        </div>

                                        {/* Pattern Details */}
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginBottom: '20px' }}>
                                            <div style={{ background: '#f8f9fa', padding: '15px', borderRadius: '8px' }}>
                                                <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Current Price</div>
                                                <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#333' }}>â‚¹{selectedStock.price}</div>
                                            </div>
                                            <div style={{ background: selectedStock.technical.pattern.type === 'BULLISH' ? '#dcfce7' : '#fee2e2', padding: '15px', borderRadius: '8px' }}>
                                                <div style={{ fontSize: '12px', color: '#666', marginBottom: '5px' }}>Pattern Target</div>
                                                <div style={{ fontSize: '20px', fontWeight: 'bold', color: selectedStock.technical.pattern.type === 'BULLISH' ? '#16a34a' : '#dc2626' }}>
                                                    â‚¹{selectedStock.technical.pattern.target}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Timeframe & Reliability */}
                                        <div style={{ marginBottom: '20px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px', background: '#eff6ff', borderRadius: '8px', marginBottom: '10px' }}>
                                                <span style={{ fontSize: '14px', color: '#666' }}>â±ï¸ Expected Timeframe:</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#0369a1' }}>{selectedStock.technical.pattern.timeframe}</span>
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px', background: '#f0fdf4', borderRadius: '8px' }}>
                                                <span style={{ fontSize: '14px', color: '#666' }}>ðŸŽ¯ Pattern Reliability:</span>
                                                <span style={{ fontSize: '14px', fontWeight: 'bold', color: '#16a34a' }}>{selectedStock.technical.pattern.reliability}%</span>
                                            </div>
                                        </div>

                                        {/* Potential Gain/Loss */}
                                        <div style={{
                                            background: selectedStock.technical.pattern.type === 'BULLISH' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                                            color: 'white',
                                            padding: '15px',
                                            borderRadius: '10px',
                                            textAlign: 'center'
                                        }}>
                                            <div style={{ fontSize: '14px', marginBottom: '5px' }}>Potential {selectedStock.technical.pattern.type === 'BULLISH' ? 'Gain' : 'Loss'}</div>
                                            <div style={{ fontSize: '28px', fontWeight: 'bold' }}>
                                                {((parseFloat(selectedStock.technical.pattern.target) - parseFloat(selectedStock.price)) / parseFloat(selectedStock.price) * 100).toFixed(1)}%
                                            </div>
                                        </div>

                                        <div style={{ marginTop: '20px', padding: '12px', background: '#fef3c7', borderRadius: '8px', fontSize: '12px', color: '#92400e' }}>
                                            âš ï¸ <strong>Disclaimer:</strong> Pattern analysis is based on historical price movements. Not investment advice. Please conduct your own research.
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return null;
        }

        ReactDOM.render(
            <ErrorBoundary>
                <App />
            </ErrorBoundary>, 
            document.getElementById('root')
        );
    </script>
</body>
</html>
